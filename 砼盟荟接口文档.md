# 一. 数据表修改

## 0.1.用户管理

### 0.1.1.设置webname

```sql
----先设定公司名称
declare @company varchar(20)
declare @companyPY varchar(20)
set @company='山西太原飞灵'
set @companyPY='feiling'

update 系统_用户 set webname=@companyPY+'-'+Lower(dbo.f_GetPy_all(substring(登录名称,1,1))+   dbo.fun_getPY(substring(登录名称,2,100))) where isnull(webname,'')=''

select 'insert into users (user_login,user_pass,user_nicename,user_status,user_company,display_name) 
 values ('''+ webName +''','''+用户密码+''','''+登录名称+''',1,'''+ @company+''','''+登录名称+''')' from 系统_用户

```



### 0.1.2.函数

```sql
if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[f_GetPy_all]') and xtype in (N'FN', N'IF', N'TF'))
drop function [dbo].[f_GetPy_all]
GO

if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[fun_getPY]') and xtype in (N'FN', N'IF', N'TF'))
drop function [dbo].[fun_getPY]
GO

SET QUOTED_IDENTIFIER ON 
GO

create function [dbo].[f_GetPy_all](@str varchar(100))

returns varchar(8000)

as

begin

 declare @re varchar(8000)

 --生成临时表

 declare @t table(chr nchar(1) collate  Chinese_PRC_CS_AS_KS_WS,py nvarchar(20)) 

 insert into @t select'吖','a' 

 insert into @t select'厑','aes' 

 insert into @t select'哎','ai' 

 insert into @t select'安','an' 

 insert into @t select'肮','ang' 

 insert into @t select'凹','ao' 

 insert into @t select'八','ba' 

 insert into @t select'挀','bai' 

 insert into @t select'兡','baike' 

 insert into @t select'瓸','baiwa' 

 insert into @t select'扳','ban' 

 insert into @t select'邦','bang' 

 insert into @t select'勹','bao' 

 insert into @t select'萡','be' 

 insert into @t select'陂','bei' 

 insert into @t select'奔','ben' 

 insert into @t select'伻','beng' 

 insert into @t select'皀','bi' 

 insert into @t select'边','bian' 

 insert into @t select'辪','uu' 

 insert into @t select'灬','biao' 

 insert into @t select'憋','bie' 

 insert into @t select'汃','bin' 

 insert into @t select'冫','bing' 

 insert into @t select'癶','bo' 

 insert into @t select'峬','bu' 

 insert into @t select'嚓','ca' 

 insert into @t select'偲','cai' 

 insert into @t select'乲','cal' 

 insert into @t select'参','can' 

 insert into @t select'仓','cang' 

 insert into @t select'撡','cao' 

 insert into @t select'冊','ce' 

 insert into @t select'膥','cen' 

 insert into @t select'噌','ceng' 

 insert into @t select'硛','ceok' 

 insert into @t select'岾','ceom' 

 insert into @t select'猠','ceon' 

 insert into @t select'乽','ceor' 

 insert into @t select'叉','cha' 

 insert into @t select'犲','chai' 

 insert into @t select'辿','chan' 

 insert into @t select'伥','chang' 

 insert into @t select'抄','chao' 

 insert into @t select'车','che' 

 insert into @t select'抻','chen' 

 insert into @t select'阷','cheng' 

 insert into @t select'吃','chi' 

 insert into @t select'充','chong' 

 insert into @t select'抽','chou' 

 insert into @t select'出','chu' 

 insert into @t select'膗','chuai' 

 insert into @t select'巛','chuan' 

 insert into @t select'刅','chuang' 

 insert into @t select'吹','chui' 

 insert into @t select'旾','chun' 

 insert into @t select'踔','chuo' 

 insert into @t select'呲','ci' 

 insert into @t select'嗭','cis' 

 insert into @t select'从','cong' 

 insert into @t select'凑','cou' 

 insert into @t select'粗','cu' 

 insert into @t select'汆','cuan' 

 insert into @t select'崔','cui' 

 insert into @t select'邨','cun' 

 insert into @t select'瑳','cuo' 

 insert into @t select'撮','chua' 

 insert into @t select'咑','da' 

 insert into @t select'呔','dai' 

 insert into @t select'丹','dan' 

 insert into @t select'当','dang' 

 insert into @t select'刀','dao' 

 insert into @t select'恴','de' 

 insert into @t select'揼','dem' 

 insert into @t select'扥','den' 

 insert into @t select'灯','deng' 

 insert into @t select'仾','di' 

 insert into @t select'嗲','dia' 

 insert into @t select'敁','dian' 

 insert into @t select'刁','diao' 

 insert into @t select'爹','die' 

 insert into @t select'哋','dei' 

 insert into @t select'嚸','dim' 

 insert into @t select'丁','ding' 

 insert into @t select'丟','diu' 

 insert into @t select'东','dong' 

 insert into @t select'吺','dou' 

 insert into @t select'剢','du' 

 insert into @t select'耑','duan' 

 insert into @t select'叾','dug' 

 insert into @t select'垖','dui' 

 insert into @t select'吨','dun' 

 insert into @t select'咄','duo' 

 insert into @t select'妸','e' 

 insert into @t select'奀','en' 

 insert into @t select'鞥','eng' 

 insert into @t select'仒','eo' 

 insert into @t select'乻','eol' 

 insert into @t select'旕','eos' 

 insert into @t select'儿','er' 

 insert into @t select'发','fa' 

 insert into @t select'帆','fan' 

 insert into @t select'匚','fang' 

 insert into @t select'飞','fei' 

 insert into @t select'吩','fen' 

 insert into @t select'丰','feng' 

 insert into @t select'瓰','fenwa' 

 insert into @t select'覅','fiao' 

 insert into @t select'仏','fo' 

 insert into @t select'垺','fou' 

 insert into @t select'夫','fu' 

 insert into @t select'猤','fui' 

 insert into @t select'旮','ga' 

 insert into @t select'侅','gai' 

 insert into @t select'甘','gan' 

 insert into @t select'冈','gang' 

 insert into @t select'皋','gao' 

 insert into @t select'戈','ge' 

 insert into @t select'给','gei' 

 insert into @t select'根','gen' 

 insert into @t select'更','geng' 

 insert into @t select'啹','geu' 

 insert into @t select'喼','gib' 

 insert into @t select'嗰','go' 

 insert into @t select'工','gong' 

 insert into @t select'兝','gongfen' 

 insert into @t select'兣','gongli' 

 insert into @t select'勾','gou' 

 insert into @t select'估','gu' 

 insert into @t select'瓜','gua' 

 insert into @t select'乖','guai' 

 insert into @t select'关','guan' 

 insert into @t select'光','guang' 

 insert into @t select'归','gui' 

 insert into @t select'丨','gun' 

 insert into @t select'呙','guo' 

 insert into @t select'妎','ha' 

 insert into @t select'咍','hai' 

 insert into @t select'乤','hal' 

 insert into @t select'兯','han' 

 insert into @t select'魧','hang' 

 insert into @t select'茠','hao' 

 insert into @t select'兞','haoke' 

 insert into @t select'诃','he' 

 insert into @t select'黒','hei' 

 insert into @t select'拫','hen' 

 insert into @t select'亨','heng' 

 insert into @t select'囍','heui' 

 insert into @t select'乊','ho' 

 insert into @t select'乥','hol' 

 insert into @t select'叿','hong' 

 insert into @t select'齁','hou' 

 insert into @t select'乎','hu' 

 insert into @t select'花','hua' 

 insert into @t select'徊','huai' 

 insert into @t select'欢','huan' 

 insert into @t select'巟','huang' 

 insert into @t select'灰','hui' 

 insert into @t select'昏','hun' 

 insert into @t select'吙','huo' 

 insert into @t select'嚿','geo' 

 insert into @t select'夻','hwa' 

 insert into @t select'丌','ji' 

 insert into @t select'加','jia' 

 insert into @t select'嗧','jialun' 

 insert into @t select'戋','jian' 

 insert into @t select'江','jiang' 

 insert into @t select'艽','jiao' 

 insert into @t select'阶','jie' 

 insert into @t select'巾','jin' 

 insert into @t select'坕','jing' 

 insert into @t select'冂','jiong' 

 insert into @t select'丩','jiu' 

 insert into @t select'欍','jou' 

 insert into @t select'凥','ju' 

 insert into @t select'姢','juan' 

 insert into @t select'噘','jue' 

 insert into @t select'军','jun' 

 insert into @t select'咔','ka' 

 insert into @t select'开','kai' 

 insert into @t select'乫','kal' 

 insert into @t select'刊','kan' 

 insert into @t select'冚','hem' 

 insert into @t select'砊','kang' 

 insert into @t select'尻','kao' 

 insert into @t select'坷','ke' 

 insert into @t select'肎','ken' 

 insert into @t select'劥','keng' 

 insert into @t select'巪','keo' 

 insert into @t select'乬','keol' 

 insert into @t select'唟','keos' 

 insert into @t select'厼','keum' 

 insert into @t select'怾','ki' 

 insert into @t select'空','kong' 

 insert into @t select'廤','kos' 

 insert into @t select'抠','kou' 

 insert into @t select'扝','ku' 

 insert into @t select'夸','kua' 

 insert into @t select'蒯','kuai' 

 insert into @t select'宽','kuan' 

 insert into @t select'匡','kuang' 

 insert into @t select'亏','kui' 

 insert into @t select'坤','kun' 

 insert into @t select'拡','kuo' 

 insert into @t select'穒','kweok' 

 insert into @t select'垃','la' 

 insert into @t select'来','lai' 

 insert into @t select'兰','lan' 

 insert into @t select'啷','lang' 

 insert into @t select'捞','lao' 

 insert into @t select'仂','le' 

 insert into @t select'雷','lei' 

 insert into @t select'塄','leng' 

 insert into @t select'唎','li' 

 insert into @t select'俩','lia' 

 insert into @t select'嫾','lian' 

 insert into @t select'簗','liang' 

 insert into @t select'蹽','liao' 

 insert into @t select'毟','lie' 

 insert into @t select'厸','lin' 

 insert into @t select'伶','ling' 

 insert into @t select'溜','liu' 

 insert into @t select'瓼','liwa' 

 insert into @t select'囖','lo' 

 insert into @t select'龙','long' 

 insert into @t select'娄','lou' 

 insert into @t select'噜','lu' 

 insert into @t select'驴','lv' 

 insert into @t select'寽','lue' 

 insert into @t select'孪','luan' 

 insert into @t select'掄','lun' 

 insert into @t select'頱','luo' 

 insert into @t select'呣','m' 

 insert into @t select'妈','ma' 

 insert into @t select'遤','hweong' 

 insert into @t select'埋','mai' 

 insert into @t select'颟','man' 

 insert into @t select'牤','mang' 

 insert into @t select'匁','mangmi' 

 insert into @t select'猫','mao' 

 insert into @t select'唜','mas' 

 insert into @t select'庅','me' 

 insert into @t select'呅','mei' 

 insert into @t select'椚','men' 

 insert into @t select'掹','meng' 

 insert into @t select'踎','meo' 

 insert into @t select'瞇','mi' 

 insert into @t select'宀','mian' 

 insert into @t select'喵','miao' 

 insert into @t select'乜','mie' 

 insert into @t select'瓱','miliklanm' 

 insert into @t select'民','min' 

 insert into @t select'敏','min' 

 insert into @t select'冧','lem' 

 insert into @t select'名','ming' 

 insert into @t select'谬','miu' 

 insert into @t select'摸','mo' 

 insert into @t select'乮','mol' 

 insert into @t select'哞','mou' 

 insert into @t select'母','mu' 

 insert into @t select'旀','myeo' 

 insert into @t select'丆','myeon' 

 insert into @t select'椧','myeong' 

 insert into @t select'拏','na' 

 insert into @t select'腉','nai' 

 insert into @t select'囡','nan' 

 insert into @t select'囔','nang' 

 insert into @t select'乪','keg' 

 insert into @t select'孬','nao' 

 insert into @t select'疒','ne' 

 insert into @t select'娞','nei' 

 insert into @t select'焾','nem' 

 insert into @t select'嫩','nen' 

 insert into @t select'莻','neus' 

 insert into @t select'鈪','ngag' 

 insert into @t select'銰','ngai' 

 insert into @t select'啱','ngam' 

 insert into @t select'妮','ni' 

 insert into @t select'年','nian' 

 insert into @t select'娘','niang' 

 insert into @t select'茑','niao' 

 insert into @t select'捏','nie' 

 insert into @t select'脌','nin' 

 insert into @t select'宁','ning' 

 insert into @t select'牛','niu' 

 insert into @t select'农','nong' 

 insert into @t select'羺','nou' 

 insert into @t select'奴','nu' 

 insert into @t select'女','nv' 

 insert into @t select'疟','nue' 

 insert into @t select'瘧','nve' 

 insert into @t select'奻','nuan' 

 insert into @t select'黁','nun' 

 insert into @t select'燶','nung' 

 insert into @t select'挪','nuo' 

 insert into @t select'筽','o' 

 insert into @t select'夞','oes' 

 insert into @t select'乯','ol' 

 insert into @t select'鞰','on' 

 insert into @t select'讴','ou' 

 insert into @t select'妑','pa' 

 insert into @t select'俳','pai' 

 insert into @t select'磗','pak' 

 insert into @t select'眅','pan' 

 insert into @t select'乓','pang' 

 insert into @t select'抛','pao' 

 insert into @t select'呸','pei' 

 insert into @t select'瓫','pen' 

 insert into @t select'匉','peng' 

 insert into @t select'浌','peol' 

 insert into @t select'巼','phas' 

 insert into @t select'闏','phdeng' 

 insert into @t select'乶','phoi' 

 insert into @t select'喸','phos' 

 insert into @t select'丕','pi' 

 insert into @t select'囨','pian' 

 insert into @t select'缥','piao' 

 insert into @t select'氕','pie' 

 insert into @t select'丿','pianpang' 

 insert into @t select'姘','pin' 

 insert into @t select'乒','ping' 

 insert into @t select'钋','po' 

 insert into @t select'剖','pou' 

 insert into @t select'哣','deo' 

 insert into @t select'兺','ppun' 

 insert into @t select'仆','pu' 

 insert into @t select'七','qi' 

 insert into @t select'掐','qia' 

 insert into @t select'千','qian' 

 insert into @t select'羌','qiang' 

 insert into @t select'兛','qianke' 

 insert into @t select'瓩','qianwa' 

 insert into @t select'悄','qiao' 

 insert into @t select'苆','qie' 

 insert into @t select'亲','qin' 

 insert into @t select'蠄','kem' 

 insert into @t select'氢','qing' 

 insert into @t select'青','qing' 

 insert into @t select'銎','qiong' 

 insert into @t select'丘','qiu' 

 insert into @t select'曲','qu' 

 insert into @t select'迲','keop' 

 insert into @t select'峑','quan' 

 insert into @t select'蒛','que' 

 insert into @t select'夋','qun' 

 insert into @t select'亽','ra' 

 insert into @t select'囕','ram' 

 insert into @t select'呥','ran' 

 insert into @t select'穣','rang' 

 insert into @t select'荛','rao' 

 insert into @t select'惹','re' 

 insert into @t select'人','ren' 

 insert into @t select'扔','reng' 

 insert into @t select'日','ri' 

 insert into @t select'栄','rong' 

 insert into @t select'禸','rou' 

 insert into @t select'嶿','ru' 

 insert into @t select'撋','ruan' 

 insert into @t select'桵','rui' 

 insert into @t select'闰','run' 

 insert into @t select'叒','ruo' 

 insert into @t select'仨','sa' 

 insert into @t select'栍','saeng' 

 insert into @t select'毢','sai' 

 insert into @t select'虄','sal' 

 insert into @t select'三','san' 

 insert into @t select'桒','sang' 

 insert into @t select'掻','sao' 

 insert into @t select'色','se' 

 insert into @t select'裇','sed' 

 insert into @t select'聓','sei' 

 insert into @t select'森','sen' 

 insert into @t select'鬙','seng' 

 insert into @t select'閪','seo' 

 insert into @t select'縇','seon' 

 insert into @t select'杀','sha' 

 insert into @t select'筛','shai' 

 insert into @t select'山','shan' 

 insert into @t select'伤','shang' 

 insert into @t select'弰','shao' 

 insert into @t select'奢','she' 

 insert into @t select'申','shen' 

 insert into @t select'升','sheng' 

 insert into @t select'尸','shi' 

 insert into @t select'兙','shike' 

 insert into @t select'瓧','shiwa' 

 insert into @t select'収','shou' 

 insert into @t select'书','shu' 

 insert into @t select'刷','shua' 

 insert into @t select'摔','shuai' 

 insert into @t select'闩','shuan' 

 insert into @t select'双','shuang' 

 insert into @t select'谁','shei' 

 insert into @t select'脽','shui' 

 insert into @t select'吮','shun' 

 insert into @t select'哾','shuo' 

 insert into @t select'丝','si' 

 insert into @t select'螦','so' 

 insert into @t select'乺','sol' 

 insert into @t select'忪','song' 

 insert into @t select'凁','sou' 

 insert into @t select'苏','su' 

 insert into @t select'痠','suan' 

 insert into @t select'夊','sui' 

 insert into @t select'孙','sun' 

 insert into @t select'娑','suo' 

 insert into @t select'他','ta' 

 insert into @t select'襨','tae' 

 insert into @t select'囼','tai' 

 insert into @t select'坍','tan' 

 insert into @t select'铴','tang' 

 insert into @t select'仐','tao' 

 insert into @t select'畓','tap' 

 insert into @t select'忒','te' 

 insert into @t select'膯','teng' 

 insert into @t select'唞','teo' 

 insert into @t select'朰','teul' 

 insert into @t select'剔','ti' 

 insert into @t select'天','tian' 

 insert into @t select'旫','tiao' 

 insert into @t select'怗','tie' 

 insert into @t select'厅','ting' 

 insert into @t select'乭','tol' 

 insert into @t select'囲','tong' 

 insert into @t select'偷','tou' 

 insert into @t select'凸','tu' 

 insert into @t select'湍','tuan' 

 insert into @t select'推','tui' 

 insert into @t select'旽','tun' 

 insert into @t select'乇','tuo' 

 insert into @t select'屲','wa' 

 insert into @t select'歪','wai' 

 insert into @t select'乛','wan' 

 insert into @t select'尣','wang' 

 insert into @t select'危','wei' 

 insert into @t select'塭','wen' 

 insert into @t select'翁','weng' 

 insert into @t select'挝','wo' 

 insert into @t select'乌','wu' 

 insert into @t select'夕','xi' 

 insert into @t select'诶','ei' 

 insert into @t select'疨','xia' 

 insert into @t select'仙','xian' 

 insert into @t select'乡','xiang' 

 insert into @t select'灱','xiao' 

 insert into @t select'楔','xie' 

 insert into @t select'心','xin' 

 insert into @t select'星','xing' 

 insert into @t select'凶','xiong' 

 insert into @t select'休','xiu' 

 insert into @t select'旴','xu' 

 insert into @t select'昍','xuan' 

 insert into @t select'疶','xue' 

 insert into @t select'坃','xun' 

 insert into @t select'丫','ya' 

 insert into @t select'咽','yan' 

 insert into @t select'彦','yan' 

 insert into @t select'欕','eom' 

 insert into @t select'央','yang' 

 insert into @t select'吆','yao'  

 insert into @t select'椰','ye' 

 insert into @t select'膶','yen' 

 insert into @t select'一','yi' 

 insert into @t select'乁','i' 

 insert into @t select'乚','yin' 

 insert into @t select'应','ying' 

 insert into @t select'哟','yo' 

 insert into @t select'佣','yong' 

 insert into @t select'优','you' 

 insert into @t select'迂','yu' 

 insert into @t select'囦','yuan' 

 insert into @t select'曰','yue' 

 insert into @t select'蒀','yun' 

 insert into @t select'帀','za' 

 insert into @t select'災','zai' 

 insert into @t select'兂','zan' 

 insert into @t select'牂','zang' 

 insert into @t select'遭','zao' 

 insert into @t select'啫','ze' 

 insert into @t select'贼','zei' 

 insert into @t select'怎','zen' 

 insert into @t select'曽','zeng' 

 insert into @t select'吒','zha' 

 insert into @t select'甴','gad' 

 insert into @t select'夈','zhai' 

 insert into @t select'毡','zhan' 

 insert into @t select'张','zhang' 

 insert into @t select'钊','zhao' 

 insert into @t select'蜇','zhe' 

 insert into @t select'贞','zhen' 

 insert into @t select'凧','zheng' 

 insert into @t select'之','zhi' 

 insert into @t select'中','zhong' 

 insert into @t select'州','zhou' 

 insert into @t select'劯','zhu' 

 insert into @t select'抓','zhua' 

 insert into @t select'专','zhuan' 

 insert into @t select'转','zhuai' 

 insert into @t select'妆','zhuang' 

 insert into @t select'骓','zhui' 

 insert into @t select'宒','zhun' 

 insert into @t select'卓','zhuo' 

 insert into @t select'孜','zi' 

 insert into @t select'唨','zo' 

 insert into @t select'宗','zong' 

 insert into @t select'棸','zou' 

 insert into @t select'哫','zu' 

 insert into @t select'劗','zuan' 

 insert into @t select'厜','zui' 

 insert into @t select'尊','zun' 

 insert into @t select'昨','zuo' 

 

 declare @strlen int 

 select @strlen=len(@str),@re=''

 while @strlen>0

 begin     

      select top 1 @re=UPPER(substring(py,1,1) )+substring(py,2,len(py))+@re,@strlen=@strlen-1 

      from @t a where chr<=substring(@str,@strlen,1) 

      order by chr collate Chinese_PRC_CS_AS_KS_WS  desc 

      if @@rowcount=0

        select @re=substring(@str,@strlen,1)+@re,@strlen=@strlen-1

   end

 return(@re)

end


GO
-----------------------------------------------------------------------

create function fun_getPY(@str nvarchar(4000)) 
returns nvarchar(4000) 
as 
begin 
declare @word nchar(1),@PY nvarchar(4000) 
set @PY='' 
while len(@str)>0 
begin 
set @word=left(@str,1) 
--如果非汉字字符，返回原字符 
set @PY=@PY+(case when unicode(@word) between 19968 and 19968+20901 
then (select top 1 PY from ( 
select 'A' as PY,N'驁' as word 
union all select 'B',N'簿' 
union all select 'C',N'錯' 
union all select 'D',N'鵽' 
union all select 'E',N'樲' 
union all select 'F',N'鰒' 
union all select 'G',N'腂' 
union all select 'H',N'夻' 
union all select 'J',N'攈' 
union all select 'K',N'穒' 
union all select 'L',N'鱳' 
union all select 'M',N'旀' 
union all select 'N',N'桛' 
union all select 'O',N'漚' 
union all select 'P',N'曝' 
union all select 'Q',N'囕' 
union all select 'R',N'鶸' 
union all select 'S',N'蜶' 
union all select 'T',N'籜' 
union all select 'W',N'鶩' 
union all select 'X',N'鑂' 
union all select 'Y',N'韻' 
union all select 'Z',N'咗' 
) T 
where word>=@word collate Chinese_PRC_CS_AS_KS_WS 
order by PY ASC) else @word end) 
set @str=right(@str,len(@str)-1) 
end 
return @PY 
end 

GO
```



### 0.1.2.显示树

手动添加订单管理，地图等

```sql
update 系统_显示树 set 说明='InQuery',showType='APP' where 显示标题='进货查询'
update 系统_显示树 set 说明='Contract',showType='APP' where 显示标题='合同管理'
update 系统_显示树 set 说明='Task',showType='APP' where 显示标题='任务管理'
update 系统_显示树 set 说明='Dispatch',showType='APP' where 显示标题='主调度窗体'
update 系统_显示树 set 说明='Ratio',showType='APP' where 显示标题='配比通知单'
update 系统_显示树 set 说明='Contract_C',showType='APP' where 显示标题='合同审批'
update 系统_显示树 set 说明='Ratio_C',showType='APP' where 显示标题='配比审批'
update 系统_显示树 set 说明='GPS',showType='APP' where 显示标题='地图'
update 系统_显示树 set 说明='OutQuery',showType='APP' where 显示标题='出货查询'
update 系统_显示树 set 说明='Oil',showType='APP' where 显示标题='加油管理'
update 系统_显示树 set 说明='Customer',showType='APP' where 显示标题='客户管理'
update 系统_显示树 set 说明='Customer',showType='APP' where 显示标题='客户管理'
update 系统_显示树 set 说明='Car',showType='APP' where 显示标题='车辆管理'
update 系统_显示树 set 说明='Contract',showType='APP' where 显示标题='合同管理'
update 系统_显示树 set 说明='Task_C',showType='APP' where 显示标题='任务审批'
update 系统_显示树 set 说明='Task',showType='APP' where 显示标题='任务管理'
update 系统_显示树 set 说明='Warehouse',showType='APP' where 显示标题='仓库'
update 系统_显示树 set 说明='Device',showType='APP' where 显示标题='设备管理'
update 系统_显示树 set 说明='QC',showType='APP' where 显示标题='质检确认发车'

GO
```



系统参数设置

```sql
insert into cv_系统_参数设置 (项目,值,可否设置,所属系统,关联窗口) values ('日偏移量小时','8.00',1,'系统',',')
```



## 1.1.合同管理

### 1.1.1.视图 

PV_Contract

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Contract]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Contract]
Go

CREATE VIEW [dbo].[PV_Contract]
AS
SELECT  c50f0 AS 合同编号, CASE IF3 WHEN 1 THEN '已归档' ELSE CASE WHEN (c50f0 IN
                       (SELECT DISTINCT c50f3
                        FROM       rw_ren_wu_nei_rong
                        WHERE    c50f12 = '正在进行')) THEN '正在进行' ELSE '新合同' END END AS 合同进行情况, c50f5 AS 承揽业务员, 
                   c200f1 AS 客户名称, c200f2 AS 施工单位, c200f3 AS 工程名称, c200f4 AS 施工地点, c200f5 AS 施工部位, nf0 AS 运距, 
                   nf1 AS 数量, nf2 AS 合计总价, c200f6 AS 付款结算方式和期限, df0 AS 供砼时间, c50f8 AS 浇注方式, 
                   c200f0 AS 其他技术要求, c50f9 AS 混凝土标记, c50f10 AS 砼强度等级, c50f11 AS 坍落度, c50f12 AS 联系电话, 
                   c200f7 AS 合理损耗和计算办法, c200f8 AS 其他约定事项, c50f31 AS 分公司列表, create_time AS 录入时间, 
                   update_time AS 修改时间, create_person AS 录入人
FROM      dbo.ht_he_tong_nei_rong

GO
```



PV_Contract_E

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Contract_E]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Contract_E]
Go

CREATE VIEW [dbo].[PV_Contract_E]
AS
SELECT  c50f0 AS contractId, c50f1 AS idInbook, c50f2 AS owner, c50f5 AS saleman, c50f7 AS status, c50f8 AS P, c50f9 AS cMarking, 
                   c50f10 AS G, c50f11 AS slump, c50f12 AS tel, c200f0 AS techOpts, c200f1 AS customer, c200f2 AS bulider, 
                   c200f3 AS prjName, c200f4 AS prjAddr, c200f5 AS prjPart, c200f6 AS payOpts, c200f7 AS lossOpts, c200f8 AS othOpts, 
                   df0 AS suyDt, df1 AS signDt, CAST(nf0 AS decimal(3, 1)) AS distance, nf1 AS sumV, nf2 AS sumM, create_time AS createDt, 
                   create_person AS writer, update_time AS modifyDt
FROM      dbo.ht_he_tong_nei_rong

GO
```



### 1.1.2.存储过程

```sql
IF Exists(select name from sysobjects where name = 'GPV' and type = 'P')
Drop Proc GPV
Go

CREATE PROCEDURE [dbo].[GPV]
(
	@tblName varchar(200), ----要显示的表或多个表的连接
	@fldName varchar(500) = '*', ----要显示的字段列表
	@pageSize int = 10, ----每页显示的记录个数
	@page int = 1, ----要显示那一页的记录
	@fldSort varchar(200) = null, ----排序字段列表或条件
	@Sort bit = 0, ----排序方法，0为升序，1为降序(如果是多字段排列Sort指代最后一个排序字段的排列顺序(最后一个排序字段不加排序标记)--程序传参如：' SortA Asc,SortB Desc,SortC ')
	@strCondition varchar(1000) = null, ----查询条件,不需where
	@ID  varchar(150), ----主表的主键
	@Dist bit = 0, ----是否添加查询字段的 DISTINCT 默认0不添加/1添加
	@pageCount int = 1 output, ----查询结果分页后的总页数
	@Counts int = 1 output ----查询到的记录数
)
AS

	SET NOCOUNT ON
	Declare @sqlTmp nvarchar(1000) ----存放动态生成的SQL语句
	Declare @strTmp nvarchar(1000) ----存放取得查询结果总数的查询语句
	Declare @strID nvarchar(1000) ----存放取得查询开头或结尾ID的查询语句
	
	Declare @strSortType nvarchar(10) ----数据排序规则A
	Declare @strFSortType nvarchar(10) ----数据排序规则B
	
	Declare @SqlSelect nvarchar(50) ----对含有DISTINCT的查询进行SQL构造
	Declare @SqlCounts nvarchar(50) ----对含有DISTINCT的总数查询进行SQL构造
	
	declare @timediff datetime --耗时测试时间差
	select @timediff=getdate()
	
	if @Dist = 0
	begin
		set @SqlSelect = 'select '
		set @SqlCounts = 'Count(*)'
	end
	else
	begin
		set @SqlSelect = 'select distinct '
		set @SqlCounts = 'Count(DISTINCT '+@ID+')'
	end
	
	
	if @Sort=0
	begin
		set @strFSortType=' ASC '
		set @strSortType=' DESC '
	end
	else
	begin
		set @strFSortType=' DESC '
		set @strSortType=' ASC '
	end
	
	
	
	--------生成查询语句--------
	--此处@strTmp为取得查询结果数量的语句
	if @strCondition is null or @strCondition='' --没有设置显示条件
	begin
		set @sqlTmp = @fldName + ' From ' + @tblName
		set @strTmp = @SqlSelect+' @Counts='+@SqlCounts+' FROM '+@tblName
		set @strID = ' From ' + @tblName
	end
	else
	begin
		set @sqlTmp = + @fldName + 'From ' + @tblName + ' where ' + @strCondition
		set @strTmp = @SqlSelect+' @Counts='+@SqlCounts+' FROM '+@tblName + ' where  ' + @strCondition
		set @strID = ' From ' + @tblName + ' where  ' + @strCondition
	end
	
	
	----取得查询结果总数量-----
	exec sp_executesql @strTmp,N'@Counts int out ',@Counts out
	

	declare @tmpCounts int
	if @Counts = 0
		set @tmpCounts = 1
	else
		set @tmpCounts = @Counts
	
	--取得分页总数
	set @pageCount=(@tmpCounts+@pageSize-1)/@pageSize
	

	/**//**//**//**当前页大于总页数 取最后一页**/
	if @page>@pageCount
		set @page=@pageCount
	
	--/*-----数据分页2分处理-------*/
	declare @pageIndex int --总数/页大小
	declare @lastcount int --总数%页大小
	
	set @pageIndex = @tmpCounts/@pageSize
	set @lastcount = @tmpCounts%@pageSize
	if @lastcount > 0
		set @pageIndex = @pageIndex + 1
	else
		set @lastcount = @pagesize
	

	
	--//***显示分页
	if @strCondition is null or @strCondition='' --没有设置显示条件
	begin
		print  '没有设置显示条件'
		if @pageIndex<2 or @page<=@pageIndex / 2 + @pageIndex % 2 --前半部分数据处理
			begin
				print  '--前半部分数据处理'
				print  @page
				if @page=1
					set @strTmp=@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
						+' order by '+ @fldSort +' '+ @strFSortType
				else
				begin
					print  @Sort
					if @Sort=1
					begin
						set @strTmp=@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
						+' where '+@ID+' <(select min('+ @ID +') from ('+ @SqlSelect+' top '+ CAST(@pageSize*(@page-1) as Varchar(20)) +' '+ @ID +' from '+@tblName
						+' order by '+ @fldSort +' '+ @strFSortType+') AS TBMinID)'
						+' order by '+ @fldSort +' '+ @strFSortType
						print  @strTmp
					end
					else
					begin
						print  'aaaaa'
						set @strTmp=@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
						+' where '+@ID+' >(select max('+ @ID +') from ('+ @SqlSelect+' top '+ CAST(@pageSize*(@page-1) as Varchar(20)) +' '+ @ID +' from '+@tblName
						+' order by '+ @fldSort +' '+ @strFSortType+') AS TBMinID)'
						+' order by '+ @fldSort +' '+ @strFSortType
						print  @strTmp
					end
					print  @strTmp
				end
			end
		else
		begin
			print  '--后半部分数据处理'
			set @page = @pageIndex-@page+1 --后半部分数据处理
			if @page <= 1 --最后一页数据显示
				set @strTmp=@SqlSelect+' * from ('+@SqlSelect+' top '+ CAST(@lastcount as VARCHAR(4))+' '+ @fldName+' from '+@tblName
				+' order by '+ @fldSort +' '+ @strSortType+') AS TempTB'+' order by '+ @fldSort +' '+ @strFSortType
			else
				if @Sort=1
				begin
					set @strTmp=@SqlSelect+' * from ('+@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
					+' where '+@ID+' >(select max('+ @ID +') from('+ @SqlSelect+' top '+ CAST(@pageSize*(@page-2)+@lastcount as Varchar(20)) +' '+ @ID +' from '+@tblName
					+' order by '+ @fldSort +' '+ @strSortType+') AS TBMaxID)'
					+' order by '+ @fldSort +' '+ @strSortType+') AS TempTB'+' order by '+ @fldSort +' '+ @strFSortType
				end
				else
				begin
					set @strTmp=@SqlSelect+' * from ('+@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
					+' where '+@ID+' <(select min('+ @ID +') from('+ @SqlSelect+' top '+ CAST(@pageSize*(@page-2)+@lastcount as Varchar(20)) +' '+ @ID +' from '+@tblName
					+' order by '+ @fldSort +' '+ @strSortType+') AS TBMaxID)'
					+' order by '+ @fldSort +' '+ @strSortType+') AS TempTB'+' order by '+ @fldSort +' '+ @strFSortType
				end
		end
		print  @strTmp
	end
	else --有查询条件
	begin
		if @pageIndex<2 or @page<=@pageIndex / 2 + @pageIndex % 2 --前半部分数据处理
		begin
			if @page=1
				set @strTmp=@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
				+' where  ' + @strCondition + ' order by '+ @fldSort +' '+ @strFSortType
			else if(@Sort=1)
			begin
				set @strTmp=@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
				+' where '+@ID+' <(select min('+ @ID +') from ('+ @SqlSelect+' top '+ CAST(@pageSize*(@page-1) as Varchar(20)) +' '+ @ID +' from '+@tblName
				+' where  ' + @strCondition +' order by '+ @fldSort +' '+ @strFSortType+') AS TBMinID)'
				+' and ('+ @strCondition +') order by '+ @fldSort +' '+ @strFSortType
			end
			else
			begin
				set @strTmp=@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
				+' where '+@ID+' >(select max('+ @ID +') from ('+ @SqlSelect+' top '+ CAST(@pageSize*(@page-1) as Varchar(20)) +' '+ @ID +' from '+@tblName
				+' where ' + @strCondition +' order by '+ @fldSort +' '+ @strFSortType+') AS TBMinID)'
				+' and ('+ @strCondition +') order by '+ @fldSort +' '+ @strFSortType
			end
		end
		else
		begin
			print '---后半部分数据处理---'
			set @page = @pageIndex-@page+1 --后半部分数据处理
			if @page <= 1 --最后一页数据显示
				set @strTmp=@SqlSelect+' * from ('+@SqlSelect+' top '+ CAST(@lastcount as VARCHAR(4))+' '+ @fldName+' from '+@tblName
				+' where  '+ @strCondition +' order by '+ @fldSort +' '+ @strSortType+') AS TempTB'+' order by '+ @fldSort +' '+ @strFSortType
			else if(@Sort=1)
				set @strTmp=@SqlSelect+' * from ('+@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
				+' where '+@ID+' >(select max('+ @ID +') from('+ @SqlSelect+' top '+ CAST(@pageSize*(@page-2)+@lastcount as Varchar(20)) +' '+ @ID +' from '+@tblName
				+' where  '+ @strCondition +' order by '+ @fldSort +' '+ @strSortType+') AS TBMaxID)'
				+' '+ @strCondition+' order by '+ @fldSort +' '+ @strSortType+') AS TempTB'+' order by '+ @fldSort +' '+ @strFSortType
			else
				set @strTmp=@SqlSelect+' * from ('+@SqlSelect+' top '+ CAST(@pageSize as VARCHAR(4))+' '+ @fldName+' from '+@tblName
				+' where '+@ID+' <(select min('+ @ID +') from('+ @SqlSelect+' top '+ CAST(@pageSize*(@page-2)+@lastcount as Varchar(20)) +' '+ @ID +' from '+@tblName
				+' where '+ @strCondition +' order by '+ @fldSort +' '+ @strSortType+') AS TBMaxID)'
				+' '+ @strCondition+' order by '+ @fldSort +' '+ @strSortType+') AS TempTB'+' order by '+ @fldSort +' '+ @strFSortType
		end
		print  @strTmp
	end 

	print  @strTmp
	------返回查询结果-----
	
	exec   sp_executesql   @strTmp
		
	select @pageCount as pageCount,@Counts as Counts 
	--select datediff(ms,@timediff,getdate()) as 耗时
	
	SET NOCOUNT OFF

GO
```



P合同签收量日历

```sql
IF Exists(select name from sysobjects where name = 'P合同签收量日历' and type = 'P')
Drop Proc P合同签收量日历
Go

CREATE PROCEDURE [dbo].[P合同签收量日历]
	@htID varchar(20)
AS
	--DECLARE @htID varchar(20)
	--set  @htID='2013-00370'
	SET DATEFIRST 1
	DECLARE @date char(10)
	DECLARE @date1  char(10)
	select @date = min(出车时间),@date1 =max(出车时间)+1 from cv_发货单_发货单 where 任务编号 in (select 任务编号 from cv_任务_任务内容 where 合同编号=@htID)
	select @date = dateadd(d,-day(@date)+1,@date) 
	select @date1= dateadd(d,-day(@date1),dateadd(m,1,@date1))
	--select @date,@date1
	select 月 m,周 w,
	       max(case 星期 when 1 then DATEPART(day,b.日期)   end ) as 'w1', max(case 星期 when 1 then isnull(签收量,0) end) as 'v1',
	       max(case 星期 when 2 then DATEPART(day,b.日期)   end ) as 'w2', max(case 星期 when 2 then isnull(签收量,0) end) as 'v2',
	       max(case 星期 when 3 then DATEPART(day,b.日期)   end ) as 'w3', max(case 星期 when 3 then isnull(签收量,0) end) as 'v3',
	       max(case 星期 when 4 then DATEPART(day,b.日期)   end ) as 'w4', max(case 星期 when 4 then isnull(签收量,0) end) as 'v4',
	       max(case 星期 when 5 then DATEPART(day,b.日期)   end ) as 'w5', max(case 星期 when 5 then isnull(签收量,0) end) as 'v5',
	       max(case 星期 when 6 then DATEPART(day,b.日期)   end ) as 'w6', max(case 星期 when 6 then isnull(签收量,0) end) as 'v6',
	       max(case 星期 when 7 then DATEPART(day,b.日期)   end ) as 'w7', max(case 星期 when 7 then isnull(签收量,0) end) as 'v7'
	from (
	
	select dateadd(d,a.number,@date) 日期,convert(varchar(7),dateadd(d,a.number,@date),121) 月,datepart(wk,dateadd(d,a.number,@date)) 周,DATEPART(weekday,dateadd(d,a.number,@date)) 星期
	FROM master..spt_values a
	WHERE a.type = 'P'
	    AND number BETWEEN 1 AND  case when datedIff(d,@date,@date1)>255 then 255 else  datedIff(d,@date,@date1) end
	) b left join 
	(
	select convert(varchar(10),出车时间,121) 日期, sum(发车签收量) 签收量  from cv_发货单_发货单  fh left join cv_任务_任务内容 rw on fh.任务编号=rw.任务编号 
where rw.合同编号=@htID  and   出车时间 between @date and @date1 group by convert(varchar(10),出车时间,121)
	) c on b.日期=c.日期
	group by 月,周 
	order by 月 desc 
    RETURN 0

GO
```



P合同签收量时间轴

```sql
IF Exists(select name from sysobjects where name = 'P合同签收量时间轴' and type = 'P')
Drop Proc P合同签收量时间轴
Go

CREATE PROCEDURE [dbo].[P合同签收量时间轴]
	@htID varchar(20)
AS
    select convert(varchar(10),出车时间,121) dt,b.砼强度等级 g,a.浇注方式 p,sum(发车签收量) v,a.任务编号 did,b.施工部位 dpart from cv_发货单_发货单 a left join cv_任务_任务内容 b on a.任务编号=b.任务编号 where b.合同编号=@htID group by convert(varchar(10),a.出车时间,121),b.砼强度等级,a.浇注方式,a.任务编号,b.施工部位 order by dt
    RETURN 0

GO
```



### 1.1.3.函数

getDeliverList

```sql
IF exists(select * from dbo.sysobjects where id = object_id(N'[dbo].[getDeliverList]') and (type = 'FN' or type = 'TF'))
DROP FUNCTION getDeliverList
Go

CREATE FUNCTION [dbo].[getDeliverList](@taskID varchar(10))
RETURNS varchar(5000)
AS
BEGIN
declare @ss varchar(2000)

set @ss=''
	select top 15 @ss=@ss+
		case when @ss='' then '' else ',' end+
		'{"id":"'+aa.发货单编号+'","c":"'+aa.内部车号+'","d":"'+aa.司机+'","t":"'+CONVERT(varchar(19),aa.出车时间,121)+'","h":"'+aa.发车货物类型+'","v":"'++cast(bb.发车单车数量 as varchar(5))
		+'","i":"'+'s' + 
	case when isnull(aa.生产状态,'') = '开始生产' then  '1' else '0' end  + 
	case when isnull(aa.生产状态,'') = '生产完毕' then  '1' else '0' end  + 
	case when isnull(aa.是否已过磅,0)=1 then '1' else '0' end  +'0'+'"}' 
from  cv_调度_车辆调度 aa left join cv_发货单_发货单 bb on aa.发货单编号 = bb.发货单编号 where aa.任务编号=@taskID order by aa.发货单编号
return '['+@ss+']'
END 

GO
```



## 1.2.任务管理

### 1.2.1.视图

PV_Task

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Task]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Task]
Go

CREATE VIEW [dbo].[PV_Task]
AS
SELECT   a.c50f0 AS 任务编号, a.c50f3 AS 合同编号, a.c50f1 AS 书面编号, a.c200f0 AS 建设单位, a.c200f2 AS 工程名称, 
                a.c200f1 AS 施工单位, a.c200f3 AS 施工地点, a.nf0 AS 运距, a.c200f4 AS 施工部位, a.c50f4 AS 产品种类, a.nf1 AS 数量, 
                a.c50f5 AS 配合比编号, a.c50f6 AS 强度等级, a.c50f7 AS 抗冻等级, a.c50f8 AS 抗渗等级, a.c50f9 AS 坍落度, 
                a.c50f10 AS 浇注方式, a.c50f11 AS 联系电话, a.df0 AS 发布时间, a.df1 AS 供砼时间, a.c50f12 AS 进行情况, 
                ISNULL(b.nf0, 0) AS 任务完成量, ISNULL(b.IF0, 0) AS 实发车数, a.c200f5 AS 备注, a.IF0 AS 强制卡方, a.nf6 AS 砼单价, 
                a.nf8 AS 泵送单价, a.nf9 AS 台班费, a.nf2 AS 砂浆方量, a.IF6 AS 间隔时间, a.create_person AS 录入人, 
                a.c50f20 AS 分公司列表
FROM      dbo.rw_ren_wu_nei_rong AS a LEFT OUTER JOIN
                dbo.rw_ren_wu_lei_ji AS b ON a.c50f0 = b.c50f0

GO
```



PV_Task_E

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Task_E]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Task_E]
Go

CREATE VIEW [dbo].[PV_Task_E]
AS
SELECT   aa.任务编号 AS taskId, aa.合同编号 AS cId, aa.具体工程名称 AS prjName, aa.具体施工单位 AS builder, 
                aa.具体施工地点 AS addr, aa.具体运距 AS distance, aa.施工部位 AS prjPart, aa.货物类型 AS hType, aa.砼数量 AS V, 
                aa.配合比编号 AS rId, aa.砼强度等级 AS G, aa.抗冻等级 AS FG, aa.抗渗等级 AS PG, aa.坍落度 AS slump, 
                aa.浇注方式 AS P, aa.联系电话 AS tel, aa.发布时间 AS createDt, aa.供砼时间 AS supDt, aa.进行情况 AS status, 
                bb.完成 AS Ved, bb.车数 AS carsed, aa.备注 AS remark, aa.是否强制卡方 AS forceLimit, 
                aa.发车间隔提醒分钟数 AS range, aa.创建人 AS creater, aa.分公司名称 AS subComList
FROM      dbo.cv_任务_任务内容 AS aa LEFT OUTER JOIN
                dbo.cv_任务_任务累计 AS bb ON aa.任务编号 = bb.任务编号

GO 
```



PV_Task_C

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Task_C]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Task_C]
Go

CREATE VIEW [dbo].[PV_Task_C]
AS
SELECT   aa.合同编号, aa.任务编号, aa.书面任务编号, aa.具体工程名称, aa.具体施工单位, bb.建设单位, aa.施工部位, 
                aa.货物类型, aa.砼强度等级, aa.砼数量 AS 数量, aa.坍落度 AS 坍落度, aa.浇注方式, aa.供砼时间, aa.联系电话, 
                bb.施工地点, aa.进行情况, bb.运距 AS 运距, bb.施工单位, bb.工程名称, bb.承揽业务员, aa.创建人, aa.发布时间, 
                bb.合理损耗和计算办法, bb.其他约定事项, bb.付款结算方式和期限
FROM      dbo.cv_任务_任务内容 AS aa LEFT OUTER JOIN
                dbo.cv_合同_合同内容 AS bb ON aa.合同编号 = bb.合同编号
WHERE   (aa.进行情况 = '需审核')

GO
```



## 1.3.配比管理

### 1.3.1.视图

PV_Ratio

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Ratio]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Ratio]
Go

CREATE VIEW [dbo].[PV_Ratio]
AS
SELECT   r.任务编号, r.具体工程名称, r.具体施工单位, r.施工部位, r.货物类型, r.砼强度等级, r.浇注方式, r.坍落度, r.进行情况, 
                2 AS sts, MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱1名称 ELSE NULL END) AS n1_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱1规格 ELSE NULL END) AS r1_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱1量 ELSE NULL END) AS v1_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱1含水率 ELSE NULL END) AS s1_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱2名称 ELSE NULL END) AS n2_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱2规格 ELSE NULL END) AS r2_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱2量 ELSE NULL END) AS v2_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱2含水率 ELSE NULL END) AS s2_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱3名称 ELSE NULL END) AS n3_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱3规格 ELSE NULL END) AS r3_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱3量 ELSE NULL END) AS v3_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱3含水率 ELSE NULL END) AS s3_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱4名称 ELSE NULL END) AS n4_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱4规格 ELSE NULL END) AS r4_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱4量 ELSE NULL END) AS v4_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱4含水率 ELSE NULL END) AS s4_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱5名称 ELSE NULL END) AS n5_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱5规格 ELSE NULL END) AS r5_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱5量 ELSE NULL END) AS v5_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱5含水率 ELSE NULL END) AS s5_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱6名称 ELSE NULL END) AS n6_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱6规格 ELSE NULL END) AS r6_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱6量 ELSE NULL END) AS v6_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱6含水率 ELSE NULL END) AS s6_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱7名称 ELSE NULL END) AS n7_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱7规格 ELSE NULL END) AS r7_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱7量 ELSE NULL END) AS v7_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱7含水率 ELSE NULL END) AS s7_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱8名称 ELSE NULL END) AS n8_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱8规格 ELSE NULL END) AS r8_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱8量 ELSE NULL END) AS v8_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱8含水率 ELSE NULL END) AS s8_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱9名称 ELSE NULL END) AS n9_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱9规格 ELSE NULL END) AS r9_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱9量 ELSE NULL END) AS v9_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱9含水率 ELSE NULL END) AS s9_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱10名称 ELSE NULL END) AS n10_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱10规格 ELSE NULL END) AS r10_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱10量 ELSE NULL END) AS v10_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱10含水率 ELSE NULL END) AS s10_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱11名称 ELSE NULL END) AS n11_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱11规格 ELSE NULL END) AS r11_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱11量 ELSE NULL END) AS v11_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱11含水率 ELSE NULL END) AS s11_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱12名称 ELSE NULL END) AS n12_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱12规格 ELSE NULL END) AS r12_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱12量 ELSE NULL END) AS v12_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱12含水率 ELSE NULL END) AS s12_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱13名称 ELSE NULL END) AS n13_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱13规格 ELSE NULL END) AS r13_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱13量 ELSE NULL END) AS v13_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱13含水率 ELSE NULL END) AS s13_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱14名称 ELSE NULL END) AS n14_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱14规格 ELSE NULL END) AS r14_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱14量 ELSE NULL END) AS v14_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站1' THEN a.料舱14含水率 ELSE NULL END) AS s14_1, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱1名称 ELSE NULL END) AS n1_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱1规格 ELSE NULL END) AS r1_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱1量 ELSE NULL END) AS v1_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱1含水率 ELSE NULL END) AS s1_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱2名称 ELSE NULL END) AS n2_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱2规格 ELSE NULL END) AS r2_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱2量 ELSE NULL END) AS v2_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱2含水率 ELSE NULL END) AS s2_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱3名称 ELSE NULL END) AS n3_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱3规格 ELSE NULL END) AS r3_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱3量 ELSE NULL END) AS v3_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱3含水率 ELSE NULL END) AS s3_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱4名称 ELSE NULL END) AS n4_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱4规格 ELSE NULL END) AS r4_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱4量 ELSE NULL END) AS v4_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱4含水率 ELSE NULL END) AS s4_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱5名称 ELSE NULL END) AS n5_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱5规格 ELSE NULL END) AS r5_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱5量 ELSE NULL END) AS v5_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱5含水率 ELSE NULL END) AS s5_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱6名称 ELSE NULL END) AS n6_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱6规格 ELSE NULL END) AS r6_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱6量 ELSE NULL END) AS v6_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱6含水率 ELSE NULL END) AS s6_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱7名称 ELSE NULL END) AS n7_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱7规格 ELSE NULL END) AS r7_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱7量 ELSE NULL END) AS v7_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱7含水率 ELSE NULL END) AS s7_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱8名称 ELSE NULL END) AS n8_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱8规格 ELSE NULL END) AS r8_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱8量 ELSE NULL END) AS v8_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱8含水率 ELSE NULL END) AS s8_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱9名称 ELSE NULL END) AS n9_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱9规格 ELSE NULL END) AS r9_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱9量 ELSE NULL END) AS v9_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱9含水率 ELSE NULL END) AS s9_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱10名称 ELSE NULL END) AS n10_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱10规格 ELSE NULL END) AS r10_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱10量 ELSE NULL END) AS v10_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱10含水率 ELSE NULL END) AS s10_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱11名称 ELSE NULL END) AS n11_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱11规格 ELSE NULL END) AS r11_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱11量 ELSE NULL END) AS v11_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱11含水率 ELSE NULL END) AS s11_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱12名称 ELSE NULL END) AS n12_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱12规格 ELSE NULL END) AS r12_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱12量 ELSE NULL END) AS v12_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱12含水率 ELSE NULL END) AS s12_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱13名称 ELSE NULL END) AS n13_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱13规格 ELSE NULL END) AS r13_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱13量 ELSE NULL END) AS v13_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱13含水率 ELSE NULL END) AS s13_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱14名称 ELSE NULL END) AS n14_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱14规格 ELSE NULL END) AS r14_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱14量 ELSE NULL END) AS v14_2, 
                MAX(CASE 搅拌站 WHEN '搅拌站2' THEN a.料舱14含水率 ELSE NULL END) AS s14_2
FROM      dbo.cv_任务_任务内容 AS r LEFT OUTER JOIN
                dbo.cv_搅拌站_配比明细 AS a ON r.任务编号 = a.任务编号 LEFT OUTER JOIN
                dbo.cv_搅拌站_配比主表 AS c ON r.任务编号 = c.任务编号
GROUP BY r.任务编号, r.具体工程名称, r.具体施工单位, r.施工部位, r.货物类型, r.砼强度等级, r.浇注方式, r.坍落度, r.进行情况

GO
```



## 1.4.调度管理

### 1.4.1.表

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[Stat_DaySum]') and OBJECTPROPERTY(id, N'IsUserTable') = 1)
drop table [Stat_DaySum]
GO

CREATE TABLE [dbo].[Stat_DaySum](
	[dt] [varchar](50) NULL,
	[outSum] [decimal](10, 2) NULL
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO
```



### 1.4.2.视图

PV_Deliver

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Deliver]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Deliver]
Go

CREATE VIEW [dbo].[PV_Deliver]
AS
SELECT   aa.发货单编号, aa.任务编号, cc.工程名称 AS 具体工程名称, cc.建设单位 AS 客户名称, cc.施工单位 AS 具体施工单位, 
                bb.施工部位, bb.砼强度等级, bb.抗冻等级, bb.抗渗等级, ISNULL(bb.砼强度等级, N'') + ISNULL(bb.抗冻等级, N'') 
                + ISNULL(bb.抗渗等级, N'') AS 强度, bb.坍落度, bb.备注, cc.运距, aa.搅拌站, aa.出车时间, aa.调度员, aa.质检员, 
                aa.司磅员, aa.内部车号, aa.司机, aa.浇注方式, aa.泵车号, aa.发车货物类型, aa.发车单车数量, aa.注释, aa.皮重, 
                aa.毛重, aa.净重, aa.回皮时间, aa.发车实发数量, aa.发车签收量, aa.是否已过磅, aa.发车设定量, aa.主机操作, 
                aa.现场调度, bb.具体施工地点 AS 施工地点, bb.具体运距, bb.合同编号, dd.配合比编号, aa.调度安排时间, aa.返厂时间, 
                DATEDIfF(n, aa.出车时间, aa.返厂时间) AS 运输时间, CONVERT(varchar(10), aa.出车时间 - 0.3125, 120) AS 出车日期, 
                ISNULL(bb.发车间隔提醒分钟数,
                    (SELECT   ISNULL(值, 120) AS Expr1
                     FROM      dbo.cv_系统_参数设置
                     WHERE   (项目 = '默认车量发车超时提醒分钟数'))) AS 设定提醒时间, DATEDIfF(n, aa.出车时间, aa.返厂时间) 
                AS 实际运输时间, CASE WHEN datedIff(n, aa.出车时间, aa.返厂时间) > isnull(bb.发车间隔提醒分钟数,
                    (SELECT   isnull(值, 120)
                     FROM      cv_系统_参数设置
                     WHERE   项目 = '默认车量发车超时提醒分钟数')) THEN '超时' ELSE '不超时' END AS 是否超时, cc.客户来源, 
                cc.承揽业务员
FROM      dbo.cv_发货单_发货单 AS aa LEFT OUTER JOIN
                dbo.cv_任务_任务内容 AS bb ON aa.任务编号 = bb.任务编号 LEFT OUTER JOIN
                dbo.cv_合同_合同内容 AS cc ON bb.合同编号 = cc.合同编号 LEFT OUTER JOIN
                dbo.cv_试验_配比通知单 AS dd ON aa.任务编号 = dd.任务编号

GO
```



### 1.4.3.触发器

```sql
IF exists(select * from dbo.sysobjects where id = object_id(N'[dbo].[TR_出货日合计]') and OBJECTPROPERTY(id, N'IsTrigger') = 1)
drop trigger TR_出货日合计
Go

CREATE TRIGGER [dbo].[TR_出货日合计] ON [dbo].fhd_fa_huo_dan
FOR INSERT,UPDATE,DELETE
AS
    declare @日偏移量 decimal(6,2)
	
    select @日偏移量=isnull(值,0) from cv_系统_参数设置 WHERE (项目 = '日偏移量小时')
    select @日偏移量=cast(isnull(@日偏移量,0) as decimal(6,2))

    insert into [Stat_DaySum] (dt)
	select 日期 as dt from (select distinct convert(varchar(10),df6-@日偏移量/24,121) 日期 from inserted) aa 
	    where  not exists(select 1 from  Stat_DaySum where dt=aa.日期 )

    update [Stat_DaySum] set outSum =isnull(outSum,0)+isnull(oSum,0)
        from (
	    select convert(varchar(10),df6-@日偏移量/24,121) 日期,sum(nf17) oSum from inserted  where isnull(if2,0)=1 and c50f47<>'水票' group by  convert(varchar(10),df6-@日偏移量/24,121)		
	) aaa where [Stat_DaySum].dt = aaa.日期
  

    update [Stat_DaySum] set outSum =isnull(outSum,0)-isnull(oSum,0)
        from (
	    select convert(varchar(10),df6-@日偏移量/24,121) 日期,sum(nf17) oSum from deleted  where isnull(if2,0)=1 and c50f47<>'水票'  group by  convert(varchar(10),df6-@日偏移量/24,121)		
	) aaa where [Stat_DaySum].dt = aaa.日期
  

GO
```



## 1.5.车辆管理

### 1.5.1.视图

PV_Car

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Car]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Car]
Go

CREATE VIEW [dbo].[PV_Car]
AS
SELECT   id, 内部车号, 车号, 类型, 载重, 皮重, 回皮时间, 用途, 使用部门, 经手人, 当前状态, 最大方数, 是否外租, 所属公司, 轴数, 
                '' AS 照片
FROM      dbo.cv_调度_车辆信息

GO
```



## 1.6.司机管理

### 1.6.1.视图

PV_Driver_E

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Driver_E]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Driver_E]
Go

CREATE VIEW [dbo].[PV_Driver_E]
AS
SELECT   a.内部车号 AS car, a.班号 AS t1, a.职工编号 AS manID1, a.司机 AS d1, c.phone AS p1, b.班号 AS t2, 
                b.职工编号 AS manID2, b.司机 AS d2, d.phone AS p2, c.wx AS wx1, d.wx AS wx2, 
                dbo.cv_调度_车辆信息.车号 AS carNo
FROM      dbo.cv_调度_出货车辆与司机 AS a LEFT OUTER JOIN
                dbo.cv_调度_车辆信息 ON a.内部车号 = dbo.cv_调度_车辆信息.内部车号 LEFT OUTER JOIN
                dbo.cv_调度_出货车辆与司机 AS b ON a.内部车号 = b.内部车号 LEFT OUTER JOIN
                dbo.Driver_Info AS c ON a.司机 = c.username LEFT OUTER JOIN
                dbo.Driver_Info AS d ON b.司机 = d.username
WHERE   (a.班号 = '1班') AND (b.班号 = '2班')

GO
```



## 1.7.料仓库存

### 1.7.1.存储过程

PP_Storage_InOut

```sql
IF Exists(select name from sysobjects where name = 'PP_Storage_InOut' and type = 'P')
Drop Proc PP_Storage_InOut
Go

CREATE PROCEDURE [dbo].[PP_Storage_InOut] 
    @st varchar(20),
    @fld varchar(50),   
    @cName varchar(100)
AS
    declare @sql nvarchar(2000)
    set @sql='
select k.dt,a.[in],b.[out] from 
(
	select  convert(varchar(10),DateAdd(day,-number+1,getdate()),121) dt
		from master..spt_values  
		where type = ''p''  
		AND number <= 32
) k left join 
 
(
	select convert(varchar(10),进货时间,121) dt,isnull(SUM(净重), 0)  [in]
		from cv_进货单_进货单
		where 进货时间 > dateadd(mm , -1, getdate()) AND 卸料地 ='''+@cName+'''
		group by convert(varchar(10),进货时间,121)
) a on k.dt=a.dt left join 
( 
	select convert(varchar(10),时间,121) dt,convert(decimal(10,2),sum('+@fld+')/1000) [out] from 搅拌站_生产记录'+@st+'
		where 时间 > dateadd(mm , -1, getdate())
		group by convert(varchar(10),时间,121)
) b on k.dt=b.dt order by b.dt desc
'

   exec   sp_executesql   @sql
   
   select @@ROWCOUNT Counts

GO
```



PP_Storage_InOut

```sql
IF Exists(select name from sysobjects where name = 'PP_Storage_InList' and type = 'P')
Drop Proc PP_Storage_InList
Go

CREATE PROCEDURE [dbo].[PP_Storage_InList]
    @cName varchar(100),
    @dt varchar(20)
AS
 select convert(varchar(8),进货时间,108) dt,净重 [in],品名 mName,规格 mRule,托运单位 supplier,运输单位 carrier ,车号 car,convert(varchar(8),进厂时间,108) inDt
		from cv_进货单_进货单
		where convert(varchar(10),进货时间,121)=@dt and 卸料地=@cName
		order by 进货时间 desc

GO
```



PP_Storage_OutList

```sql
IF Exists(select name from sysobjects where name = 'PP_Storage_OutList' and type = 'P')
Drop Proc PP_Storage_OutList
Go

CREATE PROCEDURE [dbo].[PP_Storage_OutList]
    @st varchar(20),
    @fld varchar(100),
    @dt varchar(20)
AS

	declare @sql nvarchar(2000)
	set @sql='select convert(varchar(8),时间,108) dt,cast('+@fld+' as decimal(6,1)) [out],cast('+@fld+'配比量 as decimal(6,1)) [set],cast(('+@fld+'-'+@fld+'配比量)*100/'+@fld+'配比量 as decimal(6,2)) diff, '+@fld+'名称 mName,'+@fld+'规格 mRule 
			from 搅拌站_生产记录'+@st+'
			where convert(varchar(10),时间,121)='''+@dt+''' and '+@fld+'配比量 != 0
			order by 时间 desc'
	
	exec   sp_executesql   @sql
   
   	select @@ROWCOUNT Counts

GO
```



## 1.8.进货查询

### 1.8.1 视图

v过磅_进货单

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[v过磅_进货单]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[v过磅_进货单]
Go

CREATE VIEW [dbo].[v过磅_进货单]
AS
SELECT  TOP (100) PERCENT 进货单号, 进货时间, 进厂时间, 回皮时间, CONVERT(varchar(10), 回皮时间, 120) AS 进货日期, 品名, 
                   规格, 毛重, 皮重, 净重, 折合方数, 运输单位, 托运单位, 车号, 卸料地, 备注, 收料员, 送货人, 司磅员, 毛重1, 皮重1, 净重1, 
                   结算方式, 单价, 金额, 装货地址, 修改标志, 厂家皮重, 厂家毛重, 厂家净重, 厂家方数, 轴数, 道路运输证号, 从业资格证号, 
                   回皮时磅房扣杂, 回皮时磅房含水率, DATEDIFF(n, 进厂时间, 回皮时间) AS 卸料时长
FROM      dbo.cv_进货单_进货单

GO
```



## 1.9.出货查询

### 1.9.1 视图

V通用_发货单

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[V通用_发货单]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[V通用_发货单]
Go

CREATE VIEW [dbo].[V通用_发货单]
AS
SELECT  aa.发货单编号, aa.任务编号, bb.具体建设单位 AS 建设单位, bb.具体施工单位 AS 施工单位, 
                   bb.具体工程名称 AS 工程名称, bb.具体建设单位, bb.具体施工单位, bb.具体工程名称, bb.施工部位, 
                   bb.具体运距 AS 运距, ISNULL(bb.砼强度等级, N'') + ISNULL(bb.抗冻等级, N'') + ISNULL(bb.抗渗等级, N'') AS 强度, 
                   aa.搅拌站, aa.出车时间, aa.调度员, aa.质检员, aa.司磅员, aa.内部车号 AS 车号, aa.内部车号, gg.车号 AS 外部车号, 
                   aa.司机, aa.发车货物类型 AS 货物类型, aa.发车单车数量 AS 单车数量, aa.发车设定量 AS 调度设定量, 
                   aa.发车实发数量 AS 实发数量, aa.发车签收量 AS 签收量, aa.退货量, aa.退货过磅量, aa.浇注方式, aa.皮重, aa.毛重, 
                   aa.净重, aa.回皮时间, aa.是否已过磅, aa.主机操作, bb.坍落度, aa.现场调度, aa.泵车号 AS 泵车司机, dd.配合比编号, 
                   aa.调度安排时间, aa.返厂时间 AS 返回时间, DATEDIfF(n, aa.出车时间, aa.返厂时间) AS 运输时间, 
                   CONVERT(varchar(10), aa.出车时间, 120) AS 出车日期, ISNULL(ee.提醒间隔,
                       (SELECT  ISNULL(值, 120) AS Expr1
                        FROM       dbo.cv_系统_参数设置
                        WHERE    (项目 = '默认车量发车超时提醒分钟数'))) AS 设定提醒时间, DATEDIfF(n, aa.出车时间, aa.返厂时间) 
                   AS 实际运输时间, CASE WHEN datedIff(n, aa.出车时间, aa.返厂时间) > isnull(bb.发车间隔提醒分钟数,
                       (SELECT  isnull(值, 120)
                        FROM       cv_系统_参数设置
                        WHERE    项目 = '默认车量发车超时提醒分钟数')) THEN '超时' ELSE '不超时' END AS 是否超时, 
                   CASE WHEN DATEPART(hh, 出车时间) BETWEEN 8 AND 20 THEN 1 ELSE 0 END AS 白班, CASE WHEN NOT DATEPART(hh, 
                   出车时间) BETWEEN 8 AND 20 THEN 1 ELSE 0 END AS 夜班
FROM      dbo.cv_发货单_发货单 AS aa LEFT OUTER JOIN
                   dbo.cv_任务_任务内容 AS bb ON aa.任务编号 = bb.任务编号 LEFT OUTER JOIN
                   dbo.cv_合同_合同内容 AS cc ON bb.合同编号 = cc.合同编号 LEFT OUTER JOIN
                   dbo.cv_试验_配比通知单 AS dd ON aa.任务编号 = dd.任务编号 LEFT OUTER JOIN
                   dbo.a_调度_任务单车运输时间 AS ee ON aa.任务编号 = ee.任务编号 LEFT OUTER JOIN
                   dbo.cv_调度_车辆信息 AS gg ON aa.内部车号 = gg.内部车号

GO
```



## 1.10.卖货查询



## 1.11.订单管理

### 1.11.1.表

通用_订单

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[通用_订单]') and OBJECTPROPERTY(id, N'IsUserTable') = 1)
drop table [通用_订单]
GO

CREATE TABLE [dbo].[通用_订单](
	[订单编号] [int] IDENTITY(1000000,1) NOT NULL,
	[合同编号] [varchar](20) NULL,
	[具体建设单位] [varchar](2000) NULL,
	[具体工程名称] [varchar](2000) NULL,
	[具体施工单位] [varchar](2000) NULL,
	[施工地点] [varchar](2000) NULL,
	[运距(km)] [decimal](18, 1) NULL,
	[施工部位] [varchar](2000) NULL,
	[产品种类] [varchar](50) NULL,
	[数量(方)] [real] NULL,
	[砼强度等级] [varchar](50) NULL,
	[坍落度(mm)] [varchar](50) NULL,
	[浇注方式] [varchar](50) NULL,
	[泵车要求] [varchar](200) NULL,
	[其他要求] [varchar](200) NULL,
	[联系电话] [varchar](50) NULL,
	[供砼时间] [varchar](30) NULL,
	[备注] [varchar](1000) NULL,
	[录入人] [varchar](50) NULL,
	[录入时间] [datetime] NULL CONSTRAINT [DF_通用_订单_录入时间]  DEFAULT (getdate()),
	[录入端] [varchar](30) NULL,
	[审核标志] [int] NULL CONSTRAINT [DF_通用_订单_审核标志]  DEFAULT ((0)),
	[修改人] [varchar](50) NULL,
	[修改时间] [datetime] NULL,
	[修改端] [varchar](30) NULL,
	[审核端] [varchar](50) NULL,
	[审核时间] [datetime] NULL,
	[审核人] [varchar](50) NULL,
	[任务编号] [varchar](20) NULL
) ON [PRIMARY]

GO
```



### 1.11.2.视图

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Order_E]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Order_E]
Go

CREATE VIEW [dbo].[PV_Order_E]
AS
SELECT  订单编号 AS orderId, 合同编号 AS contractId, 具体工程名称 AS prjName, 具体施工单位 AS bulider, 施工地点 AS prjAddr, 
                   [运距(km)] AS distance, 施工部位 AS prjPart, 产品种类 AS hType, [数量(方)] AS V, 砼强度等级 AS G, 
                   [坍落度(mm)] AS slump, 浇注方式 AS P, 联系电话 AS tel, 供砼时间 AS supDt, 备注 AS remark, 录入人 AS creator, 
                   录入时间 AS createDt, 录入端 AS createDev, 泵车要求 AS pumpReq, 其他要求 AS othReq, 审核标志 AS reviewed, 
                   具体建设单位 AS cust, 任务编号 AS taskId, 修改人 AS modifier, 修改时间 AS modifyDt, 修改端 AS modifyDev
FROM      dbo.通用_订单

GO
```



### 1.11.3.存储过程

```sql
IF Exists(select name from sysobjects where name = 'pro_HttpRequestData' and type = 'P')
Drop Proc pro_HttpRequestData
Go

CREATE PROCEDURE [dbo].[pro_HttpRequestData](
 @URL varchar(500),
 @status int=0 OUT,
 @returnText varchar(2000)='' OUT
 )
 AS
 BEGIN
 DECLARE @object int,
 @errSrc int
	 /*初始化对*/
	 EXEC @status = SP_OACreate 'Msxml2.ServerXMLHTTP.3.0', @object OUT
	 IF @status <> 0
	 BEGIN
	  EXEC SP_OAGetErrorInfo @object, @errSrc OUT, @returnText OUT
	  RETURN
	 END
 
	/*创建链接*/
	EXEC @status= SP_OAMethod @object,'open',NULL,'GET',@URL
	 IF @status <> 0
	 BEGIN
	  EXEC SP_OAGetErrorInfo @object, @errSrc OUT, @returnText OUT
	  RETURN
	 END
	 EXEC @status=SP_OAMethod @object,'setRequestHeader','Content-Type','application/x-www-form-urlencoded'
	 /*发起请求*/
	 EXEC @status= SP_OAMethod @object,'send',NULL
	 IF @status <> 0
	 BEGIN
	  EXEC SP_OAGetErrorInfo @object, @errSrc OUT, @returnText OUT
	  RETURN
	 END
	 /*获取返回*/
 
	EXEC @status= SP_OAGetProperty @object,'responseText',@returnText OUT
 
	IF @status <> 0 
 
	BEGIN 
 
	 EXEC SP_OAGetErrorInfo @object, @errSrc OUT, @returnText OUT
 
	 RETURN
 
	END
END

GO
```



sendWXmsg

```sql
IF Exists(select name from sysobjects where name = 'sendWXmsg' and type = 'P')
Drop Proc sendWXmsg
Go

CREATE PROCEDURE [dbo].[sendWXmsg]
	@toType varchar(50),
	@toStaName varchar(50),    --  搅拌站名称
	@toBusiType varchar(50),
	@toBusiText varchar(50),   --  业务名称
	@msgType varchar(50),
	@msg varchar(8000)
AS	
		DECLARE @return_value int,
		@status int,
		@returnText varchar(2000),
		@URL varchar(8000)
		select @URL = 'http://47.107.119.236/sendmsg.php?toType='+@toType+'&stdName='+@toStaName+'&'+@toBusiType+'='+@toBusiText+'&msgType='+@msgType+'&msg='+@msg
		insert eventlog (event) values (@URL)
		exec	@return_value = [dbo].[pro_HttpRequestData]
				@URL,
				@status = @status OUTPUT,
				@returnText = @returnText OUTPUT;
		return 1 

GO
```



### 1.11.4.触发器

TR_订单审核_微信提示

```sql
IF exists(select * from dbo.sysobjects where id = object_id(N'[dbo].[TR_订单审核_微信提示]') and OBJECTPROPERTY(id, N'IsTrigger') = 1)
drop trigger TR_订单审核_微信提示
Go

CREATE TRIGGER [dbo].[TR_订单审核_微信提示] ON [dbo].[通用_订单] 
for UPDATE
AS
	
	declare @count int
	select @count=count(*) from inserted
	IF @count=1
	begin
		declare @订单编号 varchar(20),
			@合同编号 varchar(20),
			@施工部位 varchar(2000),
			@数量 varchar(20),
			@浇注方式 varchar(50),
		    @砼强度等级 varchar(50),
		    @供砼时间 varchar(30),
		    @审批标志 bit,
		    @del审批标志 bit,
		    @stdName varchar(50),
		    @msg varchar(8000)
		select top 1 @订单编号=cast(订单编号 as varchar(20)),
			@施工部位=isnull(施工部位,''),
			@数量= cast(isnull([数量(方)],1) as varchar(20)),
			@浇注方式=isnull(浇注方式,''),
		    @砼强度等级=isnull(砼强度等级,''),
		    @供砼时间= convert(varchar(19),供砼时间,121),
		    @合同编号=ISNULL(合同编号,''),
		    @审批标志=审核标志 from inserted
		select @del审批标志=审核标志 from deleted
		select @stdName=值 from cv_系统_参数设置 where 项目='公司全称'
		IF isnull(@del审批标志,0)=0 and isnull(@审批标志,1)=1 and ISNULL(@stdName,'')<>''
		begin            
			select 1
			select  @msg ='{"oID":"' +@订单编号+'","std":"'+@stdName+'","G":"'+@砼强度等级+'","P":"'+@浇注方式+'","V":"'+@数量+'","evt":"订单审核","res":"审核通过","pPart":"'+@施工部位+'","dt":"'+@供砼时间+'"}'
			exec sendWXmsg 'wxUserBusiniess_id',@stdName,'businiessId',@合同编号,'oderResult',@msg
		end
		else
		begin  
			select 2
			--insert eventlog (event) values ('bbb')
		end
	end
GO
```



# 二. 接口文档

## 1.1.接口说明

接口基准地址

http://47.107.119.236:8088

公用header

| 参数名               | 参数值                           | 备注      |
| -------------------- | -------------------------------- | --------- |
| X-Tmh-Application-Id | tongmenghui                      |           |
| X-Tmh-REST-API-Key   | 13834113580                      |           |
| X-Tmh-Session-Token  | e003aacfdd51538e64c5b9c5d6f8fa07 | 用户token |

注：所有分页获取参数page，pageSize都可省略，即获取所有记录



## 1.2.登录

### 1.2.1.登录接口

请求路径：http://47.107.119.236:8088/Login

请求方法：get

请求参数

| 参数名 | 参数值        | 备注   |
| ------ | ------------- | ------ |
| ac     | feiling-admin | 用户名 |
| psw    | zanblo        |        |

响应参数

| 参数名       | 参数值   |
| ------------ | -------- |
| user_login   | 登录名称 |
| display_name | 用户名称 |
| token        | 凭证     |
| group_code   | 公司代码 |
| group_name   | 公司名称 |

响应数据

```json
{
	"code": 0,
	"user_ID": "103097",
	"user_login": "feiling-admin",
	"display_name": "系统管理员",
	"token": "085f07107dfec2c4d386a010d2d32a9b",
	"group_name": "山西太原飞灵",
	"group_code": "000000001",
	"telNumber": ""
}
```



### 1.2.2.获取用户信息

请求路径：http://47.107.119.236:8088

请求方法：get

请求参数

响应参数

| 参数名      | 参数说明     |
| ----------- | ------------ |
| Username    | 用户名称     |
| usercompany | 公司名称     |
| baseUrl     | 公司映射地址 |
| protocol    |              |
| groupCode   | 公司代码     |
| webName     | 登录名       |

响应数据

```json
{
	"Username": "系统管理员",
	"userCompany": "山西太原飞灵本地",
	"baseUrl": "http://47.107.119.236:7020",
	"protocol": "ws",
	"groupCode": "000000002",
	"webName": "feiling-admin"
}
```

**注：此接口获取的baseUrl 作为后续接口的baseUrl**



### 1.2.3.获取用户权限

请求路径：http://47.107.119.236:8088/Accout/getLimit

请求方法：get

请求参数

| 参数名 | 参数值        | 备注   |
| ------ | ------------- | ------ |
| user   | feiling-admin | 用户名 |

响应参数

| 参数名 | 参数说明 |
| ------ | -------- |
| M      | 权限名   |
| L      | 权限     |

响应数据

```json
{
	"count": null,
	"pageCount": 1,
	"results": [
		{
			"M": "Car",
			"L": "RW"
		},
		{
			"M": "Contract",
			"L": "RW"
		},
		{
			"M": "Contract_C",
			"L": "RW"
		},
		{
			"M": "Device",
			"L": "RW"
		},
		{
			"M": "Dispatch",
			"L": "RW"
		},
		{
			"M": "Driver",
			"L": "RW"
		},
		{
			"M": "GPS",
			"L": null
		},
		{
			"M": "InQuery",
			"L": "RW"
		},
		{
			"M": "Oil",
			"L": "RW"
		},
		{
			"M": "Order_C",
			"L": null
		},
		{
			"M": "OutQuery",
			"L": "RW"
		},
		{
			"M": "QC",
			"L": "RW"
		},
		{
			"M": "Ratio",
			"L": "RW"
		},
		{
			"M": "Task",
			"L": "RW"
		},
		{
			"M": "Task_C",
			"L": "RW"
		},
		{
			"M": "Warehouse",
			"L": null
		}
	]
}
```



## 1.3.合同管理

### 1.3.1.分页获取合同

请求路径：http://47.107.119.236:7020/Contract?page=页码&pageSize=每页记录数

请求示例：http://47.107.119.236:7020/Contract?page=5&pageSize=2

请求方法：get

请求参数

| 参数名   | 参数值 | 备注           |
| -------- | ------ | -------------- |
| page     | 5      | 请求第几页数据 |
| pageSize | 2      | 每页的记录数   |

响应参数

参数数据

```json
{
	"count": 121,
	"pageCount": 61,
	"results": [
		{
			"合同编号": "G121-00005",
			"承揽业务员": "",
			"合同进行情况": "新合同",
			"建设单位": "阳曲四合院改造工程",
			"施工单位": "山西苏峰建筑装饰设计工程有限公司",
			"工程名称": "阳曲四合院改造工程",
			"施工地点": "青龙古镇紫光阁",
			"施工部位": "",
			"运距": 10,
			"数量": 0,
			"合计总价": 0,
			"付款结算方式和期限": "",
			"供砼时间": "1900-01-01 00:00:00.000",
			"浇注方式": "",
			"其他技术要求": "",
			"混凝土标记": "",
			"砼强度等级": "",
			"坍落度": "",
			"联系电话": "",
			"合理损耗和计算办法": "",
			"其他约定事项": "",
			"分公司列表": null,
			"录入时间": "2021-03-09 07:40:36.360",
			"修改时间": "2021-03-09 07:40:36.373",
			"录入人": "吕伟",
			"备用字段4": null
		},
		{
			"合同编号": "G121-00004",
			"承揽业务员": "",
			"合同进行情况": "新合同",
			"建设单位": "太原市热力实业有限公司年产400KM预制直埋保温管（二期）喷涂缠绕线生产项目",
			"施工单位": "山西陆成建筑安装工程有限公司",
			"工程名称": "太原市热力实业有限公司年产400KM预制直埋保温管（二期）喷涂缠绕线生产项目",
			"施工地点": "阳曲县产业园区太原实业有限公司院内",
			"施工部位": "",
			"运距": 20,
			"数量": 0,
			"合计总价": 0,
			"付款结算方式和期限": "",
			"供砼时间": "1900-01-01 00:00:00.000",
			"浇注方式": "",
			"其他技术要求": "",
			"混凝土标记": "",
			"砼强度等级": "",
			"坍落度": "",
			"联系电话": "",
			"合理损耗和计算办法": "",
			"其他约定事项": "",
			"分公司列表": null,
			"录入时间": "2021-03-08 21:58:58.050",
			"修改时间": "2021-03-08 21:58:58.063",
			"录入人": "吕伟",
			"备用字段4": null
		}
	]
}
```



### 1.3.2.根据合同编号获取合同

请求路径：http://47.107.119.236:7020/Contract/合同编号

请求示例：http://47.107.119.236:7020/Contract/G119-00040

请求方法：get

响应参数

响应数据

```json
{
	"合同编号": "G119-00040",
	"承揽业务员": "",
	"合同进行情况": "新合同",
	"建设单位": "山西省万家寨引黄入晋工程联接段阳曲原水直供工程输水管线建筑安装Ⅲ标",
	"施工单位": "山西省水利建筑工程局引黄阳曲供水Ⅲ标工程项目部",
	"工程名称": "山西省万家寨引黄入晋工程联接段阳曲原水直供工程输水管线建筑安装Ⅲ标",
	"施工地点": "",
	"施工部位": "",
	"运距": "12.00",
	"数量": ".00",
	"合计总价": ".00",
	"付款结算方式和期限": "",
	"供砼时间": "1900-01-01 00:00:00.000",
	"浇注方式": "",
	"其他技术要求": "",
	"混凝土标记": "",
	"砼强度等级": "",
	"坍落度": "",
	"联系电话": "",
	"合理损耗和计算办法": "",
	"其他约定事项": "",
	"分公司列表": null,
	"录入时间": "2019-11-16 14:48:41.180",
	"修改时间": "2019-11-16 14:48:41.180",
	"录入人": "吕伟",
	"备用字段4": null
}
```



### 1.3.3.添加合同

请求路径：http://47.107.119.236:8088/Contract/New

请求方法：post

请求参数

请求数据

```json
{
    "合同编号":"",
    "结算归属":"",
    "客户名称":"csy",
    "施工单位":"csy测试施工单位",
    "工程名称":"csy测试工程名称",
    "承揽业务员":"业务员csy",
    "施工地点":"csy测试施工单位",
    "施工部位":"",
    "产品种类":"砼",
    "运距":"",
    "数量":"",
    "供砼时间":"",
    "浇注方式":"",
    "其他技术要求":"",
    "联系电话":"",
    "合理损耗和计算办法":"",
    "其他约定事项":"",
    "签定时间":"",
    "合同进行情况":"",
    "书面合同编号":"",
    "录入人":"csy",
    "录入时间":"",
    "修改时间":"",
    "备用字段1":"",
    "录入端":""
}
```

响应参数

| 参数名 | 说明              |
| ------ | ----------------- |
| code   | 返回码            |
| res    | 返回成功，success |
| id     | 新生成的合同编号  |

响应数据

```json
{
	"code": 0,
	"res": "sucess",
	"id": "X122-00001"
}
```



### 1.3.4.合同界面进度比例图（强度比例图）

请求路径：http://47.107.119.236:7020/Client/Fun/getContratHType?busniess_id=合同编号

请求示例：http://47.107.119.236:7020/Client/Fun/getContratHType?busniess_id=G121-00009

请求方法：get

| 参数名      | 参数值     | 备注     |
| ----------- | ---------- | -------- |
| busniess_id | G121-00009 | 合同编号 |

响应参数

| 参数名 | 说明       |
| ------ | ---------- |
| name   | 砼强度等级 |
| value  | 砼数量     |

响应数据

```json
{
	"RecordCount": "9",
	"pageCount": 1,
	"Records": [
		{
			"name": "C15",
			"value": "52.74"
		},
		{
			"name": "C20",
			"value": "77.34"
		},
		{
			"name": "C20细石",
			"value": "12.66"
		},
		{
			"name": "C25",
			"value": "368.17"
		},
		{
			"name": "C25细石",
			"value": "51.22"
		},
		{
			"name": "C35",
			"value": "3.24"
		},
		{
			"name": "C35P6",
			"value": "1658.69"
		},
		{
			"name": "C45",
			"value": "8.10"
		},
		{
			"name": "C45P6",
			"value": "10.07"
		}
	]
}
```



### 1.3.5.合同界面进度时间轴

请求路径：http://47.107.119.236:7020/Client/Fun/getContratTimeline?busniess_id=合同编号

请求示例：http://47.107.119.236:7020/Client/Fun/getContratTimeline?busniess_id=G121-00009

请求方法：get

| 参数名      | 参数值     | 备注     |
| ----------- | ---------- | -------- |
| busniess_id | G121-00009 | 合同编号 |

响应参数

| 参数名 | 说明               |
| ------ | ------------------ |
| dt     | 时间               |
| item   | 单任务统计         |
| g      | 强度等级           |
| p      | 浇筑方式           |
| v      | 总发货量           |
| did    | 任务单号           |
| dpart  | 施工部位           |
| v      | 当日该任务总发货量 |

响应数据

```json
[
	{
		"dt": "2021-06-22",
		"items": [
			{
				"g": "C35P6",
				"p": "泵送",
				"v": "790.24",
				"did": "G121-01092",
				"dpart": "教室公寓基础"
			}
		],
		"v": 790.24
	},
	{
		"dt": "2021-08-04",
		"items": [
			{
				"g": "C25",
				"p": "泵送",
				"v": "52.30",
				"did": "G121-01621",
				"dpart": "挡土墙基础"
			}
		],
		"v": 52.3
	},
	{
		"dt": "2021-08-05",
		"items": [
			{
				"g": "C20",
				"p": "自卸",
				"v": "9.53",
				"did": "G121-01654",
				"dpart": "路面硬化"
			}
		],
		"v": 9.53
	},
    ...
]
```



### 1.3.6.发放通行证(更新通行证)

请求路径：http://47.107.119.236:8088/Lc/WXAccout/手机号

请求示例：http://47.107.119.236:8088/Lc/WXAccout/18834810770

请求方法：post

请求参数：

```json
{
    "mixstd_name":"山西太原飞灵本地",
    "mixstd_id":"000000002",
    "busniess_id":"G121-00009",
    "busniess_name":"太原市致远实验中学校改扩建项目",
    "pass_type":"A",
    "authorizer":"系统管理员",
    "user_phone":"18834810770",
    "limit":"211121"
}
```

响应参数

| 参数名      | 说明   |
| ----------- | ------ |
| code        |        |
| msg         |        |
| passport_id | 通行证 |

响应数据

```json
{
	"code": 0,
	"msg": "发放通行证成功！",
	"passport_id": "ee1a9aaa628024290eb70072fecc130d"
}
```



### 1.3.7.获取通行证

请求路径：http://47.107.119.236:8088/Lc/Passport/Fun/getPassportsByGrpCode?busniess_id=合同编号

请求示例：http://47.107.119.236:8088/Lc/Passport/Fun/getPassportsByGrpCode?busniess_id=G119-00028

请求方法：get

响应参数

响应数据

```json
{
	"RecordCount": "2",
	"pageCount": 1,
	"Records": [
		{
			"id": "1198",
			"passport_id": "e70fc08d065a54c919d681bb474edd60",
			"user_phone": "18434391747",
			"pass_type": "A",
			"mixstd_id": "000000002",
			"busniess_id": "G119-00028",
			"mixstd_name": "山西太原飞灵本地",
			"busniess_name": "太原市致远实验中学校改扩建项目",
			"authorizer": "系统管理员",
			"limit": "211121",
			"reg_date": null,
			"enable": null,
			"expired_date": null,
			"display_name": null
		},
		{
			"id": "1189",
			"passport_id": "94be2dd9444f354a9fbdf83578f69f9d",
			"user_phone": "18834810770",
			"pass_type": "A",
			"mixstd_id": "000000002",
			"busniess_id": "G119-00028",
			"mixstd_name": "山西太原飞灵本地",
			"busniess_name": "待定",
			"authorizer": "系统管理员",
			"limit": "222121",
			"reg_date": null,
			"enable": null,
			"expired_date": null,
			"display_name": "张三"
		}
	]
}
```



### 1.3.8.删除通行证

请求路径：http://47.107.119.236:8088/Lc/Passport/通行证

请求示例：http://47.107.119.236:8088/Lc/Passport/e70fc08d065a54c919d681bb474edd60

请求方法：delete

响应参数

响应数据

```json
{
	"code": 0,
	"res": "sucess",
	"id": "e70fc08d065a54c919d681bb474edd60"
}
```



## 1.4.任务管理

### 1.4.1.分页获取任务

请求路径：http://47.107.119.236:7020/Task?page=页码&pageSize=每页记录数

请求示例：http://47.107.119.236:7020/Task?page=5&pageSize=2

请求方法：get

| 参数名   | 参数值 | 备注           |
| -------- | ------ | -------------- |
| page     | 5      | 请求第几页数据 |
| pageSize | 2      | 每页的记录数   |

响应参数

响应数据

```json
{
	"count": 11351,
	"pageCount": 5676,
	"results": [
		{
			"任务编号": "G121-02888",
			"合同编号": "G119-00028",
			"书面编号": "G121-0031335456460",
			"建设单位": "山西金峰建筑工程有限公司",
			"工程名称": "锦绣状元府7号楼",
			"施工单位": "山西金峰建筑工程有限公司",
			"施工地点": "锦绣大街",
			"运距": 20,
			"施工部位": "梁板",
			"产品种类": "砼",
			"数量": 170,
			"配合比编号": "G121-02888",
			"强度等级": "C30P6",
			"抗冻等级": "",
			"抗渗等级": "",
			"坍落度": "140±20",
			"浇注方式": "泵送",
			"联系电话": 13403513926,
			"发布时间": "2021-10-22 12:23:09.000",
			"供砼时间": "2021-10-22 12:23:04.000",
			"进行情况": "已完成",
			"任务完成量": 0,
			"实发车数": 0,
			"备注": "",
			"强制卡方": 0,
			"砼单价": null,
			"泵送单价": null,
			"台班费": null,
			"砂浆方量": 0,
			"间隔时间": null,
			"录入人": "吕伟",
			"分公司列表": "兴泰总站"
		},
		{
			"任务编号": "G121-02887",
			"合同编号": "G119-00028",
			"书面编号": "G121-011641665339200",
			"建设单位": "太平洋建设集团有限公司",
			"工程名称": "太行一号旅游公路阳曲黄泥路（改造工程）",
			"施工单位": "太平洋建设集团有限公司",
			"施工地点": "杨新河桥",
			"运距": 20,
			"施工部位": "5#台右幅台帽",
			"产品种类": "砼",
			"数量": 41.5,
			"配合比编号": "G121-02887",
			"强度等级": "C40",
			"抗冻等级": "",
			"抗渗等级": "",
			"坍落度": "180±20",
			"浇注方式": "泵送",
			"联系电话": 13915112444,
			"发布时间": "2021-10-22 11:52:19.000",
			"供砼时间": "2021-10-22 11:52:14.000",
			"进行情况": "已完成",
			"任务完成量": 43.5,
			"实发车数": 5,
			"备注": "",
			"强制卡方": 0,
			"砼单价": null,
			"泵送单价": null,
			"台班费": null,
			"砂浆方量": 0,
			"间隔时间": null,
			"录入人": "吕伟",
			"分公司列表": "兴泰总站"
		}
	]
}
```



### 1.4.2.根据任务编号获取任务

请求路径：http://47.107.119.236:7020/Task/任务编号

请求示例：http://47.107.119.236:7020/Task/G121-02888

请求方法：get

请求参数

响应参数

响应数据

```json
{
	"任务编号": "G121-02888",
	"合同编号": "G119-00028",
	"书面编号": "G121-0031335456460",
	"建设单位": "山西金峰建筑工程有限公司",
	"工程名称": "锦绣状元府7号楼",
	"施工单位": "山西金峰建筑工程有限公司",
	"施工地点": "锦绣大街",
	"运距": "20.00",
	"施工部位": "梁板",
	"产品种类": "砼",
	"数量": "170.00",
	"配合比编号": "G121-02888",
	"强度等级": "C30P6",
	"抗冻等级": "",
	"抗渗等级": "",
	"坍落度": "140±20",
	"浇注方式": "泵送",
	"联系电话": "13403513926",
	"发布时间": "2021-10-22 12:23:09.000",
	"供砼时间": "2021-10-22 12:23:04.000",
	"进行情况": "已完成",
	"任务完成量": ".00",
	"实发车数": "0",
	"备注": "",
	"强制卡方": "0",
	"砼单价": null,
	"泵送单价": null,
	"台班费": null,
	"砂浆方量": ".00",
	"间隔时间": null,
	"录入人": "吕伟",
	"分公司列表": "兴泰总站"
}
```



### 1.4.3.添加任务获取合同列表

请求路径：http://47.107.119.236:7020/Task/Fun/gContractLst?page=页码&pageSize=每页记录数

请求示例：http://47.107.119.236:7020/Task/Fun/gContractLst?page=5&pageSize=2

请求方法：get

请求参数

| 参数名   | 参数值 | 备注           |
| -------- | ------ | -------------- |
| page     | 5      | 请求第几页数据 |
| pageSize | 2      | 每页的记录数   |

响应参数

| 参数名   | 备注 |
| -------- | ---- |
| 工程名称 |      |
| 合同编号 |      |
| 施工单位 |      |
| 施工地点 |      |
| 运距     |      |

响应数据

```json
{
	"count": 121,
	"pageCount": 61,
	"results": [
		{
			"工程名称": "阳曲四合院改造工程",
			"合同编号": "G121-00005",
			"施工单位": "山西苏峰建筑装饰设计工程有限公司",
			"施工地点": "青龙古镇紫光阁",
			"运距": 10
		},
		{
			"工程名称": "太原市热力实业有限公司年产400KM预制直埋保温管（二期）喷涂缠绕线生产项目",
			"合同编号": "G121-00004",
			"施工单位": "山西陆成建筑安装工程有限公司",
			"施工地点": "阳曲县产业园区太原实业有限公司院内",
			"运距": 20
		}
	]
}
```



### 1.4.4.新建任务

请求路径：http://47.107.119.236:8088/Task/New

请求方法：post

请求参数

请求数据

```json
{
	"施工部位": "地面",
	"合同编号": "G122-00002",
	"书面编号": "",
	"建设单位": "劲松单位",
	"工程名称": "csy测试工程名称",
	"施工单位": "csy测试施工单位",
	"施工地点": "csy测试施工地点",
	"运距": "3",
	"货物类型": "砼",
	"数量": "180",
	"强度等级": "C30",
	"坍落度": "180±20",
	"浇注方式": "自卸",
	"供砼时间": "2021-09-22 04:04:13",
	"联系电话": "1884810770",
	"备注": "",
	"强制卡方": "",
	"砼单价": "",
	"泵送单价": "",
	"砂浆方量": "",
	"台班费": "",
	"录入人": "csy"
}
```

 响应参数

| 参数名 | 类型   | 说明              |
| ------ | ------ | ----------------- |
| code   | int    | 返回码            |
| res    | string | 返回成功，success |
| id     | string | 新生成的任务编号  |

 响应数据

```json
{
	"code": 0,
	"res": "sucess",
	"id": "X122-00001"
}
```



### 1.4.5.获取任务施工部位

请求路径：http://47.107.119.236:7020/Task/Fun/gPrjPartLst

请求方法：get

请求参数

响应参数

| 参数名  | 说明         |
| ------- | ------------ |
| prjPart | 任务施工部位 |
| taskId  | 任务编号     |

响应数据

```json
{
	"count": 11351,
	"pageCount": 23,
	"results": [
		{
			"prjPart": "热力检查井",
			"taskId": "G119-02050"
		},
		{
			"prjPart": "热力沉井",
			"taskId": "G119-02822"
		},
		{
			"prjPart": "热力补偿器井",
			"taskId": "G120-01108"
		},
		{
			"prjPart": "燃气基座",
			"taskId": "G121-00532"
		},
		...
	]
}
```



### 1.4.6.获取任务联系方式

请求路径：http://47.107.119.236:7020/Task/Fun/gPrjTel

请求方法：get

请求参数

响应参数

| 参数名 | 说明     |
| ------ | -------- |
| tel    | 电话号码 |
| fld    | 联系电话 |

响应数据

```json
{
	"count": 1,
	"pageCount": 1,
	"results": [
		{
			"tel": "13934604917",
			"fld": "联系电话"
		},
		{
			"tel": "18103426429",
			"fld": "联系电话"
		},
		{
			"tel": "17636602331",
			"fld": "联系电话"
		},
		{
			"tel": "13934796224",
			"fld": "联系电话"
		},
        ...
    ]
}    
```



### 1.4.7.获取任务发车列表

请求路径：http://47.107.119.236:7020/Client/fun/getTaskCarList?taskId=任务编号

请求示例：http://47.107.119.236:7020/Client/fun/getTaskCarList?taskId=G121-02883

请求方法：get

请求参数

| 参数名 | 参数值   | 备注 |
| ------ | -------- | ---- |
| taskId | 任务编号 |      |

响应参数

| 参数名       | 说明 |
| ------------ | ---- |
| 发车货物类型 |      |
| 发货单编号   |      |
| 车号         |      |
| 司机         |      |
| 出车时间     |      |
| 单车数量     |      |
| 实发数量     |      |
| 签收量       |      |
| 备注         |      |
| 车辆返回时间 |      |
| 退货量       |      |
| 调度设定量   |      |

响应数据

```json
{
	"count": 18,
	"pageCount": 1,
	"results": [
		{
			"发车货物类型": "砼",
			"发货单编号": "G121-02883AA22093230",
			"车号": 15,
			"司机": "郑崇伟",
			"出车时间": "2021-10-22 09:49:20.000",
			"单车数量": 11.77,
			"实发数量": 11.77,
			"签收量": 11.77,
			"备注": "10 22 2021 11:53AM返回",
			"车辆返回时间": "2021-10-22 11:53:12.000",
			"退货量": null,
			"调度设定量": 3
		},
		{
			"发车货物类型": "砼",
			"发货单编号": "G121-02883AA22094659",
			"车号": 32,
			"司机": "王永忠",
			"出车时间": "2021-10-22 09:59:36.000",
			"单车数量": 15.35,
			"实发数量": 15.35,
			"签收量": 15.35,
			"备注": "10 22 2021 12:14PM返回",
			"车辆返回时间": "2021-10-22 12:14:20.000",
			"退货量": null,
			"调度设定量": 3.75
		},
        ...
    ]
}    
```



## 1.5.配比管理

### 1.5.1.分页获取配比

请求路径：http://47.107.119.236:7020/Ratio?page=页码&pageSize=每页记录数

请求示例：http://47.107.119.236:7020/Ratio?page=5&pageSize=2

请求方法：get

请求参数

| 参数值 | 参数名   | 备注           |
| ------ | -------- | -------------- |
| 5      | page     | 请求第几页数据 |
| 2      | pageSize | 每页的记录数   |

响应参数

响应数据

```json
{
	"count": 11349,
	"pageCount": 5675,
	"results": [
		{
			"sts": 2,
			"n1_1": "水",
			"r1_1": "饮用水",
			"v1_1": 180,
			"s1_1": 0,
			"n2_1": "水泥",
			"r2_1": "北白P.O42.5",
			"v2_1": 323,
			"s2_1": 0,
			"n3_1": "粉煤灰",
			"r3_1": "二电厂",
			"v3_1": 47,
			"s3_1": 0,
			"n4_1": "矿粉",
			"r4_1": "广厦",
			"v4_1": 104,
			"s4_1": 0,
			"n5_1": "石子",
			"r5_1": "5-31.5",
			"v5_1": 977,
			"s5_1": 0,
			"n6_1": "外加剂",
			"r6_1": "砼高效",
			"v6_1": 12.32,
			"s6_1": 0,
			"n7_1": "砂子",
			"r7_1": "机制砂1",
			"v7_1": 370,
			"s7_1": 0,
			"n8_1": "砂子",
			"r8_1": "水洗砂2",
			"v8_1": 370,
			"s8_1": 0,
			"n9_1": null,
			"r9_1": null,
			"v9_1": null,
			"s9_1": null,
			"n10_1": null,
			"r10_1": null,
			"v10_1": null,
			"s10_1": null,
			"n11_1": null,
			"r11_1": null,
			"v11_1": null,
			"s11_1": null,
			"n12_1": null,
			"r12_1": null,
			"v12_1": null,
			"s12_1": null,
			"n13_1": null,
			"r13_1": null,
			"v13_1": null,
			"s13_1": null,
			"n14_1": null,
			"r14_1": null,
			"v14_1": null,
			"s14_1": null,
			"n1_2": "水",
			"r1_2": "饮用水",
			"v1_2": 180,
			"s1_2": 0,
			"n2_2": "水泥",
			"r2_2": "北白P.O42.5",
			"v2_2": 323,
			"s2_2": 0,
			"n3_2": "粉煤灰",
			"r3_2": "二电厂",
			"v3_2": 47,
			"s3_2": 0,
			"n4_2": "矿粉",
			"r4_2": "广厦",
			"v4_2": 104,
			"s4_2": 0,
			"n5_2": "石子",
			"r5_2": "5-31.5",
			"v5_2": 977,
			"s5_2": 0,
			"n6_2": "外加剂",
			"r6_2": "砼高效",
			"v6_2": 12.32,
			"s6_2": 0,
			"n7_2": "砂子",
			"r7_2": "机制砂1",
			"v7_2": 370,
			"s7_2": 0,
			"n8_2": "砂子",
			"r8_2": "水洗砂2",
			"v8_2": 370,
			"s8_2": 0,
			"n9_2": null,
			"r9_2": null,
			"v9_2": null,
			"s9_2": null,
			"n10_2": null,
			"r10_2": null,
			"v10_2": null,
			"s10_2": null,
			"n11_2": null,
			"r11_2": null,
			"v11_2": null,
			"s11_2": null,
			"n12_2": null,
			"r12_2": null,
			"v12_2": null,
			"s12_2": null,
			"n13_2": null,
			"r13_2": null,
			"v13_2": null,
			"s13_2": null,
			"n14_2": null,
			"r14_2": null,
			"v14_2": null,
			"s14_2": null,
			"任务编号": "G121-02886",
			"具体工程名称": "山西合成生物生态园项目",
			"具体施工单位": "中国水电基础局有限公司",
			"施工部位": "沉淀池5-6/B1-B2轴4.5米以下墙体及内部结构",
			"货物类型": "砼",
			"砼强度等级": "C35P6F200防水抗裂",
			"浇注方式": "泵送",
			"坍落度": 220,
			"进行情况": "已完成"
		},
		{
			"sts": 2,
			"n1_1": "水",
			"r1_1": "饮用水",
			"v1_1": 180,
			"s1_1": 0,
			"n2_1": "水泥",
			"r2_1": "北白P.O42.5",
			"v2_1": 323,
			"s2_1": 0,
			"n3_1": "粉煤灰",
			"r3_1": "二电厂",
			"v3_1": 47,
			"s3_1": 0,
			"n4_1": "矿粉",
			"r4_1": "广厦",
			"v4_1": 104,
			"s4_1": 0,
			"n5_1": "石子",
			"r5_1": "5-31.5",
			"v5_1": 977,
			"s5_1": 0,
			"n6_1": "外加剂",
			"r6_1": "砼高效",
			"v6_1": 12.32,
			"s6_1": 0,
			"n7_1": "砂子",
			"r7_1": "机制砂1",
			"v7_1": 370,
			"s7_1": 0,
			"n8_1": "砂子",
			"r8_1": "水洗砂2",
			"v8_1": 370,
			"s8_1": 0,
			"n9_1": null,
			"r9_1": null,
			"v9_1": null,
			"s9_1": null,
			"n10_1": null,
			"r10_1": null,
			"v10_1": null,
			"s10_1": null,
			"n11_1": null,
			"r11_1": null,
			"v11_1": null,
			"s11_1": null,
			"n12_1": null,
			"r12_1": null,
			"v12_1": null,
			"s12_1": null,
			"n13_1": null,
			"r13_1": null,
			"v13_1": null,
			"s13_1": null,
			"n14_1": null,
			"r14_1": null,
			"v14_1": null,
			"s14_1": null,
			"n1_2": "水",
			"r1_2": "饮用水",
			"v1_2": 180,
			"s1_2": 0,
			"n2_2": "水泥",
			"r2_2": "北白P.O42.5",
			"v2_2": 323,
			"s2_2": 0,
			"n3_2": "粉煤灰",
			"r3_2": "二电厂",
			"v3_2": 47,
			"s3_2": 0,
			"n4_2": "矿粉",
			"r4_2": "广厦",
			"v4_2": 104,
			"s4_2": 0,
			"n5_2": "石子",
			"r5_2": "5-31.5",
			"v5_2": 977,
			"s5_2": 0,
			"n6_2": "外加剂",
			"r6_2": "砼高效",
			"v6_2": 12.32,
			"s6_2": 0,
			"n7_2": "砂子",
			"r7_2": "机制砂1",
			"v7_2": 370,
			"s7_2": 0,
			"n8_2": "砂子",
			"r8_2": "水洗砂2",
			"v8_2": 370,
			"s8_2": 0,
			"n9_2": null,
			"r9_2": null,
			"v9_2": null,
			"s9_2": null,
			"n10_2": null,
			"r10_2": null,
			"v10_2": null,
			"s10_2": null,
			"n11_2": null,
			"r11_2": null,
			"v11_2": null,
			"s11_2": null,
			"n12_2": null,
			"r12_2": null,
			"v12_2": null,
			"s12_2": null,
			"n13_2": null,
			"r13_2": null,
			"v13_2": null,
			"s13_2": null,
			"n14_2": null,
			"r14_2": null,
			"v14_2": null,
			"s14_2": null,
			"任务编号": "G121-02885",
			"具体工程名称": "山西合成生物生态园项目",
			"具体施工单位": "中国水电基础局有限公司",
			"施工部位": "事故备用池C 7-8/B2-B3底板",
			"货物类型": "砼",
			"砼强度等级": "C35P6F200防水抗裂",
			"浇注方式": "泵送",
			"坍落度": 220,
			"进行情况": "已完成"
		}
	]
}
```



## 1.6.调度管理

### 1.6.1.调度列表

请求路径：http://47.107.119.236:7020/Dispatch/List

请求方法：get

请求参数

响应参数

响应数据

```json
{
	"count": 6,
	"pageCount": 1,
	"results": [
		{
			"carlist": "[{\"id\":\"G121-02669AA22153633\",\"c\":\"22\",\"d\":\"王二军\",\"t\":\"2021-10-22 15:44:46\",\"h\":\"砼\",\"v\":\"9.32\",\"i\":\"s0110\"},{\"id\":\"G121-02669AA22153648\",\"c\":\"15\",\"d\":\"郑崇伟\",\"t\":\"2021-10-22 15:50:20\",\"h\":\"砼\",\"v\":\"9.56\",\"i\":\"s0110\"},{\"id\":\"G121-02669AA22164412\",\"c\":\"28\",\"d\":\"王爱军\",\"t\":\"2021-10-22 16:57:06\",\"h\":\"砼\",\"v\":\"9.91\",\"i\":\"s0110\"},{\"id\":\"G121-02669AA22164419\",\"c\":\"05\",\"d\":\"周建文\",\"t\":\"2021-10-22 17:00:01\",\"h\":\"砼\",\"v\":\"10.50\",\"i\":\"s0110\"}]",
			"任务编号": "G121-02669",
			"书面任务编号": "G121-0031545656611",
			"强度": "C35",
			"浇注方式": "自卸",
			"泵车": "无",
			"联系电话": "15536822644，17891207275",
			"产品种类": "砼",
			"工程名称": "山西合成生物生态园公共管廊项目",
			"建设单位": "山西省工业设备安装集团有限公司",
			"施工单位": "山西省工业设备安装集团有限公司",
			"施工部位": "2号管廊灌桩",
			"备注": "",
			"任务缩写": "",
			"其它要求": null,
			"调度备注": null,
			"最后时间": "2021-10-02 10:08:20.460",
			"供砼日期": "2021-10-01 00:00:00.000",
			"发布日期": "2021-10-01 00:00:00.000",
			"车辆外租标志": null,
			"序号": null,
			"图标": 36,
			"间隔时间": null,
			"出车超时分钟数": null,
			"需供": 1000,
			"创建时间": null,
			"创建人": null,
			"创建端": null,
			"修改时间": null,
			"修改人": null,
			"修改端": null
		},
		{
			"carlist": "[]",
			"任务编号": "G121-02880",
			"书面任务编号": "G121-003510122",
			"强度": "C25防冻",
			"浇注方式": "自卸",
			"泵车": "无",
			"联系电话": 18634399539,
			"产品种类": "砼",
			"工程名称": "阳曲县阳兴猪厂",
			"建设单位": "张广明施工队",
			"施工单位": "张广明施工队",
			"施工部位": "路面",
			"备注": "",
			"任务缩写": "",
			"其它要求": null,
			"调度备注": null,
			"最后时间": null,
			"供砼日期": "2021-10-21 00:00:00.000",
			"发布日期": "2021-10-21 00:00:00.000",
			"车辆外租标志": null,
			"序号": null,
			"图标": 36,
			"间隔时间": null,
			"出车超时分钟数": null,
			"需供": 140,
			"创建时间": null,
			"创建人": null,
			"创建端": null,
			"修改时间": null,
			"修改人": null,
			"修改端": null
		},
        ...
    ]
}
```



### 1.6.2.调度界面发车列表

请求路径：http://47.107.119.236:7020/Dispatch/Task/CarList/任务编号

请求示例：http://47.107.119.236:7020/Dispatch/Task/CarList/G121-02669

请求方法：get

请求参数

| 参数名   | 参数值     | 备注 |
| -------- | ---------- | ---- |
| 任务编号 | G121-02669 |      |

响应参数

| 参数名       | 说明 |
| ------------ | ---- |
| 发车货物类型 |      |
| 发货单编号   |      |
| 车号         |      |
| 司机         |      |
| 出车时间     |      |
| 单车数量     |      |
| 实发数量     |      |
| 签收量       |      |
| 备注         |      |
| 车辆返回时间 |      |
| 退货量       |      |
| 调度设定量   |      |

响应数据

```json
{
	"count": 11,
	"pageCount": 1,
	"results": [
		{
			"发车货物类型": "砼",
			"发货单编号": "G121-02669AA02085648",
			"车号": 18,
			"司机": "茹春伟",
			"出车时间": "2021-10-02 09:17:11.690",
			"单车数量": 10.12,
			"实发数量": 10.12,
			"签收量": 10.12,
			"备注": "10  2 2021 11:16AM返回",
			"车辆返回时间": "2021-10-02 11:16:33.807",
			"退货量": null,
			"调度设定量": 2.5
		},
		{
			"发车货物类型": "砼",
			"发货单编号": "G121-02669AA02095408",
			"车号": 11,
			"司机": "庞明亮",
			"出车时间": "2021-10-02 10:08:20.460",
			"单车数量": 10.11,
			"实发数量": 10.11,
			"签收量": 10.11,
			"备注": "10  2 2021 12:12PM返回",
			"车辆返回时间": "2021-10-02 12:12:59.770",
			"退货量": null,
			"调度设定量": 2.5
		},
        ...
    ]
}
```



### 1.6.3.调度界面任务进度

同1.6.2.调度界面发车列表



### 1.6.4.调度界面出厂车辆发货单信息

请求路径：http://47.107.119.236:7020/Deliver/发货单编号

请求示例：http://47.107.119.236:7020/Deliver/G121-02883AA22160222

请求方法：get

请求参数

| 参数名     | 参数值               | 备注 |
| ---------- | -------------------- | ---- |
| 发货单编号 | G121-02883AA22160222 |      |

响应参数

响应数据

```json
{
	"发货单编号": "G121-02883AA22160222",
	"任务编号": "G121-02883",
	"工程名称": "待定",
	"建设单位": "个人",
	"施工单位": "个人",
	"施工部位": "事故备用池A 4-6/A3-B1轴4.5米以上墙体及内部结构带",
	"砼强度等级": "C35P6F200防水抗裂",
	"抗冻等级": "",
	"抗渗等级": "",
	"强度": "C35P6F200防水抗裂",
	"坍落度": "220",
	"备注": "",
	"运距": "20.00",
	"搅拌站": "搅拌站2",
	"出车时间": "2021-10-22 16:13:57.000",
	"调度员": "吕伟",
	"质检员": "马晓东",
	"司磅员": "庞丽萍",
	"内部车号": "29",
	"司机": "张福明",
	"浇注方式": "泵送",
	"泵车号": "002(56米）",
	"发车货物类型": "砼",
	"发车单车数量": "15.22",
	"注释": "",
	"皮重": "19.78",
	"毛重": "56.30",
	"净重": "36.52",
	"回皮时间": null,
	"发车实发数量": "15.22",
	"发车签收量": "15.22",
	"是否已过磅": "1",
	"发车设定量": "3.75",
	"主机操作": "冯向伟",
	"现场调度": "",
	"具体施工地点": "河上咀村",
	"具体运距": "20.00",
	"合同编号": "G119-00028",
	"配合比编号": "G121-02883",
	"调度安排时间": "2021-10-22 16:02:29.000",
	"返厂时间": null,
	"运输时间": null,
	"出车日期": "2021-10-22",
	"设定提醒时间": "1000",
	"实际运输时间": null,
	"是否超时": "不超时",
	"客户来源": "",
	"承揽业务员": ""
}
```



### 1.6.5.调度界面司机统计

请求路径：http://47.107.119.236:7020/Dispatch/driver/statics/开始时间/结束时间

请求示例：http://47.107.119.236:7020/Dispatch/driver/statics/2021-09-26 08:00:00/2021-10-26 08:00:00

请求方法：get

请求参数

| 参数名   | 参数值              | 备注 |
| -------- | ------------------- | ---- |
| 开始时间 | 2021-09-26 08:00:00 |      |
| 结束时间 | 2021-10-26 08:00:00 |      |

响应参数

| 参数名 | 说明 |
| ------ | ---- |
| 司机   |      |
| 车数   |      |
| 方量   |      |
| 运距   |      |
| 趟次   |      |

响应数据

```json
{
	"count": null,
	"pageCount": 1,
	"results": [
		{
			"司机": "李惠平",
			"车数": 1,
			"方量": 12.35,
			"运距": 20,
			"趟次": "■"
		},
		{
			"司机": "曹国兴",
			"车数": 3,
			"方量": 24.11,
			"运距": 18.333333,
			"趟次": "■■■"
		},
		{
			"司机": "庞永岗",
			"车数": 5,
			"方量": 47.99,
			"运距": 20,
			"趟次": "■■■■■"
		},
		{
			"司机": "张勇明",
			"车数": 8,
			"方量": 58.26,
			"运距": 20,
			"趟次": "■■■■■■■■"
		},
        ...
    ]
}        
```



### 1.6.6.调度界面罐车统计

请求路径：http://47.107.119.236:7020/Dispatch/Car/statics/开始时间/结束时间

请求示例：http://47.107.119.236:7020/Dispatch/Car/statics/2021-09-26 08:00:00/2021-10-26 08:00:00

请求方法：get

请求参数

| 参数名   | 参数值              | 备注 |
| -------- | ------------------- | ---- |
| 开始时间 | 2021-09-26 08:00:00 |      |
| 结束时间 | 2021-10-26 08:00:00 |      |

响应参数

| 参数名 | 说明 |
| ------ | ---- |
| 车号   |      |
| 车数   |      |
| 方量   |      |
| 趟次   |      |

响应数据

```json
{
	"count": null,
	"pageCount": 1,
	"results": [
		{
			"车号": 6,
			"车数": 9,
			"方量": 76.95,
			"趟次": "■"
		},
		{
			"车号": 21,
			"车数": 15,
			"方量": 97.26,
			"趟次": "■"
		},
		{
			"车号": 1,
			"车数": 18,
			"方量": 162.45,
			"趟次": "■■"
		},
        ...
    ]
}
```



### 1.6.7.调度界面泵车统计

请求路径：http://47.107.119.236:7020/Dispatch/Pump/statics/开始时间/结束时间

请求示例：http://47.107.119.236:7020/Dispatch/Pump/statics/2021-09-26 08:00:00/2021-10-26 08:00:00

请求方法：get

请求参数

| 参数名   | 参数值              | 备注 |
| -------- | ------------------- | ---- |
| 开始时间 | 2021-09-26 08:00:00 |      |
| 结束时间 | 2021-10-26 08:00:00 |      |

响应参数

| 参数名   | 说明 |
| -------- | ---- |
| 泵车司机 |      |
| 车数     |      |
| 方量     |      |
| 运距     |      |
| 趟次     |      |

响应数据

```json
{
	"count": null,
	"pageCount": 1,
	"results": [
		{
			"泵车司机": 8.002,
			"车数": 69,
			"方量": 899.5,
			"运距": 20,
			"趟次": "■■■■■■■■■■■■■■■■■■■■■■■■■"
		},
		{
			"泵车司机": "外租泵",
			"车数": 136,
			"方量": 1415.42,
			"运距": 20,
			"趟次": "■■■■■■■■■■■■■■■■■■■■■■■■■"
		},
		{
			"泵车司机": "005(37米）",
			"车数": 184,
			"方量": 1505.7,
			"运距": 20,
			"趟次": "■■■■■■■■■■■■■■■■■■■■■■■■■"
		},
    ]
}
```



### 1.6.8.调度界面工程统计

请求路径：http://47.107.119.236:7020/Dispatch/Project/statics/开始时间/结束时间

请求示例：http://47.107.119.236:7020/Dispatch/Project/statics/2021-09-26 08:00:00/2021-10-26 08:00:00

请求方法：get

请求参数

| 参数名   | 参数值              | 备注 |
| -------- | ------------------- | ---- |
| 开始时间 | 2021-09-26 08:00:00 |      |
| 结束时间 | 2021-10-26 08:00:00 |      |

响应参数

| 参数名       | 说明 |
| ------------ | ---- |
| 具体工程名称 |      |
| 具体施工单位 |      |
| 车数         |      |
| 方量         |      |
| 用时         |      |

响应数据

```json
{
	"count": null,
	"pageCount": 1,
	"results": [
		{
			"具体工程名称": "杜存虎",
			"具体施工单位": "个人",
			"车数": 1,
			"方量": 8.69,
			"用时": 162
		},
		{
			"具体工程名称": "个人王晓镭",
			"具体施工单位": "个人王晓镭",
			"车数": 3,
			"方量": 36.19,
			"用时": 144
		},
		{
			"具体工程名称": "个人张武寿",
			"具体施工单位": "张武寿",
			"车数": 2,
			"方量": 15.02,
			"用时": 224
		},
		{
			"具体工程名称": "郭现军",
			"具体施工单位": "郭现军",
			"车数": 5,
			"方量": 51.92,
			"用时": 101
		},
        ...
    ]
}
```



### 1.6.9.获取日生产总量

请求路径：http://47.107.119.236:7020/Dispatch/fun/getTodaySum

请求方法：get

请求参数

响应参数

| 参数名 | 说明     |
| ------ | -------- |
| d      |          |
| dt     | 日期     |
| outSum | 日发货量 |

响应数据

```json
{
	"count": null,
	"pageCount": 1,
	"results": [
		{
			"d": "today",
			"dt": "2022-01-24",
			"outSum": 523.41
		},
		{
			"d": "yesterday",
			"dt": "2022-01-23",
			"outSum": 978.63
		}
	]
}
```



## 1.7.车辆管理

### 1.7.1.分页获取车辆信息

请求路径：http://47.107.119.236:7020/Car

请求示例：http://47.107.119.236:7020/Car?page=2&pageSize=2

请求方法：get

请求参数

| 参数名   | 参数值 | 备注           |
| -------- | ------ | -------------- |
| page     | 2      | 请求第几页数据 |
| pageSize | 2      | 每页的记录数   |

响应参数

响应数据

```json
{
	"count": 35,
	"pageCount": 18,
	"results": [
		{
			"id": 1709,
			"内部车号": 33,
			"车号": "晋AH1865",
			"类型": "罐车",
			"载重": 31,
			"皮重": 20.24,
			"回皮时间": "2021-10-22 10:15:49.000",
			"用途": "运输混凝土",
			"使用部门": "                    ",
			"经手人": "          ",
			"当前状态": null,
			"最大方数": 15,
			"是否外租": 0,
			"所属公司": "",
			"轴数": "四轴",
			"照片": ""
		},
		{
			"id": 1708,
			"内部车号": 32,
			"车号": "晋AK6950",
			"类型": "罐车",
			"载重": 31,
			"皮重": 19.66,
			"回皮时间": "2021-09-28 04:19:26.000",
			"用途": "基准皮重:__.__  基准方量:__.__",
			"使用部门": "                    ",
			"经手人": "          ",
			"当前状态": null,
			"最大方数": 15,
			"是否外租": 0,
			"所属公司": "",
			"轴数": "四轴",
			"照片": ""
		}
	]
}
```



## 1.8.司机管理

### 1.8.1.分页获取司机信息

请求路径：http://47.107.119.236:7020/Driver

请求示例：http://47.107.119.236:7020/Driver?page=2&pageSize=2

请求方法：get

请求参数

| 参数名   | 参数值 | 备注           |
| -------- | ------ | -------------- |
| page     | 2      | 请求第几页数据 |
| pageSize | 2      | 每页的记录数   |

响应参数

响应数据

```json
{
	"count": 35,
	"pageCount": 18,
	"results": [
		{
			"car": 33,
			"t1": "1班",
			"manID1": null,
			"d1": "王文斌",
			"p1": null,
			"t2": "2班",
			"manID2": null,
			"d2": "颜红杉",
			"p2": null,
			"wx1": null,
			"wx2": null,
			"carNo": "晋AH1865"
		},
		{
			"car": 32,
			"t1": "1班",
			"manID1": null,
			"d1": "胡云生",
			"p1": null,
			"t2": "2班",
			"manID2": null,
			"d2": "王永忠",
			"p2": null,
			"wx1": null,
			"wx2": null,
			"carNo": "晋AK6950"
		}
	]
}
```



## 1.9.出货查询

### 1.9.1.出货查询

请求路径：http://47.107.119.236:7020/OutQueryN?grp=grp&where={"出车时间[<>]":["开始时间","结束时间"]}

请求示例：http://47.107.119.236:7020/OutQueryN?grp=grp&where={"出车时间[<>]":["2021-09-26 08:00:00","2021-10-26 08:00:00"]}

请求方法：get

请求参数

| 参数名 | 参数值                                                       | 备注     |
| ------ | ------------------------------------------------------------ | -------- |
| grp    | grp                                                          |          |
| where  | {"出车时间[<>]":["2021-09-26 08:00:00","2021-10-26 08:00:00"]} | 查询条件 |

响应参数

响应数据

```json
{
	"count": 262,
	"pageCount": 1,
	"results": [
		{
			"cID": "G119-00028",
			"tID": "G121-02828",
			"avgV": "1.50",
			"C": "1",
			"signV": "1.50",
			"xV": null,
			"backV": null,
			"rBackV": null,
			"realV": "1.50",
			"setV": "1.50",
			"mi": "190",
			"pName": "太行一号旅游公路阳曲黄泥路（改造工程）",
			"pPart": "2#台左右幅挡块",
			"G": "C50",
			"P": "吊机",
			"R": "已完成"
		},
		{
			"cID": "G119-00028",
			"tID": "G121-02737",
			"avgV": "2.00",
			"C": "1",
			"signV": "2.00",
			"xV": null,
			"backV": null,
			"rBackV": null,
			"realV": "2.00",
			"setV": "2.00",
			"mi": "102",
			"pName": "太行一号旅游公路阳曲黄泥路（改造工程）",
			"pPart": "垫石",
			"G": "C50",
			"P": "自卸",
			"R": "已完成"
		},
		{
			"cID": "G120-00013",
			"tID": "G121-02724",
			"avgV": "3.00",
			"C": "1",
			"signV": "3.00",
			"xV": null,
			"backV": null,
			"rBackV": null,
			"realV": "3.00",
			"setV": "3.00",
			"mi": "154",
			"pName": "阳曲县现代农业产业科创中心项目",
			"pPart": "门口铺装垫层",
			"G": "C20细石",
			"P": "自卸",
			"R": "已完成"
		},
        ...
    ]
}
```



## 1.10.进货查询

### 1.10.1.进货查询

请求路径：http://47.107.119.236:7020/OutQueryN?where={"出车时间[<>]":["开始时间","结束时间"]}

请求示例：http://47.107.119.236:7020/InQueryN?where={"进货时间[<>]":["2020-09-26 08:00:00","2020-10-26 08:00:00"]}

请求方法：get

请求参数

| 参数名 | 参数值                                                       | 备注     |
| ------ | ------------------------------------------------------------ | -------- |
| where  | {"出车时间[<>]":["2021-09-26 08:00:00","2021-10-26 08:00:00"]} | 查询条件 |

响应参数

响应数据

```json
{
	"count": 13,
	"pageCount": 1,
	"results": [
		{
			"m": "外加剂",
			"s": "羧酸",
			"t": "",
			"y": "",
			"bs": "11",
			"w": "95.40",
			"v": ".00",
			"_w": "65.10",
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "外加剂",
			"s": "羧酸",
			"t": "张智东",
			"y": "",
			"bs": "3",
			"w": "20.90",
			"v": ".00",
			"_w": "21.30",
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "水泥",
			"s": "北白P.P42.5",
			"t": "",
			"y": "",
			"bs": "107",
			"w": "3430.24",
			"v": ".00",
			"_w": "3431.36",
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "水泥",
			"s": "北白PSA32.5",
			"t": "",
			"y": "",
			"bs": "1",
			"w": "12.70",
			"v": ".00",
			"_w": "13.00",
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "水泥",
			"s": "金聚猫325",
			"t": "",
			"y": "",
			"bs": "18",
			"w": "590.50",
			"v": ".00",
			"_w": "591.04",
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "水泥",
			"s": "山水P.P42.5",
			"t": "",
			"y": "",
			"bs": "1",
			"w": "31.46",
			"v": ".00",
			"_w": "31.60",
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "石子",
			"s": "0.5",
			"t": "",
			"y": "",
			"bs": "12",
			"w": "504.66",
			"v": ".00",
			"_w": null,
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "石子",
			"s": "1-2",
			"t": "",
			"y": "",
			"bs": "147",
			"w": "5970.64",
			"v": ".00",
			"_w": null,
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "石子",
			"s": "1-3",
			"t": "",
			"y": "",
			"bs": "38",
			"w": "1283.54",
			"v": ".00",
			"_w": null,
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "砂子",
			"s": "机砂",
			"t": "",
			"y": "",
			"bs": "214",
			"w": "8568.06",
			"v": ".00",
			"_w": null,
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "砂子",
			"s": "机制砂",
			"t": "",
			"y": "",
			"bs": "71",
			"w": "3365.04",
			"v": ".00",
			"_w": null,
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "矿粉",
			"s": "S95",
			"t": "",
			"y": "",
			"bs": "56",
			"w": "1796.20",
			"v": ".00",
			"_w": "1797.24",
			"_v": null,
			"kou": null,
			"shui": null
		},
		{
			"m": "粉煤灰",
			"s": "Ⅱ级",
			"t": "",
			"y": "",
			"bs": "32",
			"w": "1007.34",
			"v": ".00",
			"_w": null,
			"_v": null,
			"kou": null,
			"shui": null
		}
	],
	"sum": {
		"": "",
		"bs": "711",
		"w": "26676.68",
		"v": ".00",
		"_w": "5950.64",
		"_v": null,
		"kou": null,
		"shui": null
	}
}
```



## 1.11.卖货查询

### 1.11.1.卖货查询

请求路径：http://47.107.119.236:7020/SaleQuery?where={"卖货时间[<>]":["开始时间","结束时间"]}

请求示例：http://47.107.119.236:7020/SaleQuery?where={"卖货时间[<>]":["2020-09-26 08:00:00","2020-10-26 08:00:00"]}

请求方法：get

请求参数

| 参数名 | 参数值                                                       | 备注     |
| ------ | ------------------------------------------------------------ | -------- |
| where  | {"卖货时间[<>]":["2021-09-26 08:00:00","2021-10-26 08:00:00"]} | 查询条件 |

响应参数

响应数据



## 1.12.任务审批

### 1.12.1.获取需审批任务列表

请求路径：http://47.107.119.236:7020/Task_C?page=页码&pageSize=每页记录数

请求示例：http://47.107.119.236:7020/Task_C?page=1&pageSize=2

请求方法：get

请求参数

| 参数名   | 参数值 | 备注           |
| -------- | ------ | -------------- |
| page     | 1      | 请求第几页数据 |
| pageSize | 2      | 每页的记录数   |

响应参数

响应数据

```json
{
	"count": 2,
	"pageCount": 1,
	"results": [
		{
			"合同编号": "G121-00005",
			"任务编号": "G122-00014",
			"书面任务编号": "G122-00014",
			"具体工程名称": "阳曲四合院改造工程",
			"具体施工单位": "山西苏峰建筑装饰设计工程有限公司",
			"建设单位": "阳曲四合院改造工程",
			"施工部位": "测试",
			"货物类型": "砼",
			"砼强度等级": "C30防冻",
			"数量": 123,
			"坍落度": "180±20",
			"浇注方式": "泵送",
			"供砼时间": "2022-01-24 03:37:17.000",
			"联系电话": 13183838453,
			"施工地点": "青龙古镇紫光阁",
			"进行情况": "需审核",
			"运距": 10,
			"施工单位": "山西苏峰建筑装饰设计工程有限公司",
			"工程名称": "阳曲四合院改造工程",
			"承揽业务员": "",
			"创建人": "系统管理员",
			"发布时间": "2022-01-24 15:33:07.460",
			"合理损耗和计算办法": "",
			"其他约定事项": "",
			"付款结算方式和期限": ""
		},
		{
			"合同编号": "G121-00007",
			"任务编号": "G122-00013",
			"书面任务编号": "G122-00013",
			"具体工程名称": "太原市集中供热阳曲热源厂建筑安装工程A",
			"具体施工单位": "山西四建集团有限公司",
			"建设单位": "太原市集中供热阳曲热源厂建筑安装工程A",
			"施工部位": "综合研发楼基础圈梁。基础柱体",
			"货物类型": "砼",
			"砼强度等级": "C50防冻",
			"数量": 123,
			"坍落度": "180±20",
			"浇注方式": "泵送",
			"供砼时间": "2022-01-24 03:35:21.000",
			"联系电话": 18834810770,
			"施工地点": "",
			"进行情况": "需审核",
			"运距": 10,
			"施工单位": "山西四建集团有限公司",
			"工程名称": "太原市集中供热阳曲热源厂建筑安装工程A",
			"承揽业务员": "",
			"创建人": "系统管理员",
			"发布时间": "2022-01-24 15:31:11.133",
			"合理损耗和计算办法": "",
			"其他约定事项": "",
			"付款结算方式和期限": ""
		}
	]
}
```



### 1.12.2.根据需审核任务编号获取需审核任务

请求路径：http://47.107.119.236:7020/Task_C/需审核任务单号

请求示例：http://47.107.119.236:7020/Task_C/G122-00006

请求方法：get

响应参数

响应数据

```json
{
	"合同编号": "G122-00002",
	"任务编号": "G122-00006",
	"书面任务编号": "G122-00006",
	"具体工程名称": "测试归档",
	"具体施工单位": "测试归档",
	"建设单位": "测试归档",
	"施工部位": "地面",
	"货物类型": "砼",
	"砼强度等级": "C55",
	"数量": "100.00",
	"坍落度": "180±20",
	"浇注方式": "泵送",
	"供砼时间": "2022-02-16 11:01:03.000",
	"联系电话": "13994119135",
	"施工地点": "测试归档",
	"进行情况": "需审核",
	"运距": "12.00",
	"施工单位": "测试归档",
	"工程名称": "测试归档",
	"承揽业务员": "",
	"创建人": "系统管理员",
	"发布时间": "2022-02-16 11:01:37.127",
	"合理损耗和计算办法": null,
	"其他约定事项": null,
	"付款结算方式和期限": null
}
```



### 1.12.3.审核任务

请求路径：http://47.107.119.236:7020/Task_C/需审核任务编号

请求示例：http://47.107.119.236:7020/Task_C/G122-00013

请求方法：put

请求参数

| 参数名         | 参数值     | 备注 |
| -------------- | ---------- | ---- |
| 需审核任务编号 | G122-00013 |      |

响应参数

| 参数名   | 说明         |
| -------- | ------------ |
| res      | sucess       |
| affected | 审核成功此条 |

响应数据

```json
{
	"code": 0,
	"res": "sucess",
	"affected": "1",
	"rec": "null"
}
```



## 1.13.料仓库存

### 1.13.1.获取料仓库存

请求路径：http://http://47.107.119.236:7020/Storage

请求方法：get

请求参数

响应参数

响应数据

```json
{
	"count": null,
	"pageCount": 1,
	"results": [
		{
			"st": "搅拌站1",
			"fld": "粉料1",
			"cName": "1站1#水泥",
			"cMax": 280,
			"cMin": 0,
			"cCur": 129.65,
			"cDate": null,
			"X": 4590,
			"Y": 6000,
			"Width": 1380,
			"Height": 2535,
			"Setting": null,
			"M": "水泥",
			"R": "北白P.O42.5",
			"i": 1
		},
		{
			"st": "搅拌站1",
			"fld": "粉料2",
			"cName": "1站2#水泥",
			"cMax": 280,
			"cMin": 0,
			"cCur": 280,
			"cDate": null,
			"X": 5760,
			"Y": 4156,
			"Width": 1380,
			"Height": 2535,
			"Setting": null,
			"M": "水泥",
			"R": "金圆P.O42.5",
			"i": 2
		},
		{
			"st": "搅拌站1",
			"fld": "粉料3",
			"cName": "1站3#粉煤灰",
			"cMax": 155,
			"cMin": 0,
			"cCur": 117.099,
			"cDate": null,
			"X": 4410,
			"Y": 2015,
			"Width": 1380,
			"Height": 2535,
			"Setting": null,
			"M": "粉煤灰",
			"R": "二电厂",
			"i": 3
		},
		{
			"st": "搅拌站1",
			"fld": "粉料4",
			"cName": "1站4#矿粉",
			"cMax": 185,
			"cMin": 0,
			"cCur": 0,
			"cDate": null,
			"X": 3030,
			"Y": 661,
			"Width": 1380,
			"Height": 2535,
			"Setting": null,
			"M": "矿粉",
			"R": "广厦",
			"i": 4
		},
		{
			"st": "搅拌站1",
			"fld": "外加剂1",
			"cName": "1站外加剂1",
			"cMax": 9.8,
			"cMin": 0,
			"cCur": 4.004,
			"cDate": null,
			"X": 1740,
			"Y": 3255,
			"Width": 1380,
			"Height": 1305,
			"Setting": null,
			"M": "外加剂",
			"R": "砼高效",
			"i": 6
		},
		{
			"st": "搅拌站1",
			"fld": "外加剂2",
			"cName": "1站外加剂2",
			"cMax": 9.8,
			"cMin": 0,
			"cCur": 0,
			"cDate": null,
			"X": 450,
			"Y": 3225,
			"Width": 1380,
			"Height": 1335,
			"Setting": null,
			"M": "外加剂",
			"R": "山大合盛",
			"i": 7
		},
		{
			"st": "搅拌站2",
			"fld": "粉料1",
			"cName": "2站1#水泥",
			"cMax": 280,
			"cMin": 0,
			"cCur": 129.65,
			"cDate": null,
			"X": 4590,
			"Y": 6000,
			"Width": 1380,
			"Height": 2535,
			"Setting": null,
			"M": "水泥",
			"R": "北白P.O42.5",
			"i": 1
		},
		{
			"st": "搅拌站2",
			"fld": "粉料2",
			"cName": "2站2#水泥",
			"cMax": 280,
			"cMin": 0,
			"cCur": 280,
			"cDate": null,
			"X": 5760,
			"Y": 4156,
			"Width": 1380,
			"Height": 2535,
			"Setting": null,
			"M": "水泥",
			"R": "金圆P.O42.5",
			"i": 2
		},
		{
			"st": "搅拌站2",
			"fld": "粉料3",
			"cName": "2站3#粉煤灰",
			"cMax": 155,
			"cMin": 0,
			"cCur": 117.099,
			"cDate": null,
			"X": 4410,
			"Y": 2015,
			"Width": 1380,
			"Height": 2535,
			"Setting": null,
			"M": "粉煤灰",
			"R": "二电厂",
			"i": 3
		},
		{
			"st": "搅拌站2",
			"fld": "粉料4",
			"cName": "2站4#矿粉",
			"cMax": 185,
			"cMin": 0,
			"cCur": 0,
			"cDate": null,
			"X": 3030,
			"Y": 661,
			"Width": 1380,
			"Height": 2535,
			"Setting": null,
			"M": "矿粉",
			"R": "广厦",
			"i": 4
		},
		{
			"st": "搅拌站2",
			"fld": "外加剂1",
			"cName": "2站外加剂1",
			"cMax": 9.8,
			"cMin": 0,
			"cCur": 4.004,
			"cDate": null,
			"X": 1740,
			"Y": 3255,
			"Width": 1380,
			"Height": 1305,
			"Setting": null,
			"M": "外加剂",
			"R": "砼高效",
			"i": 6
		},
		{
			"st": "搅拌站2",
			"fld": "外加剂2",
			"cName": "2站外加剂2",
			"cMax": 9.8,
			"cMin": 0,
			"cCur": 0,
			"cDate": null,
			"X": 450,
			"Y": 3225,
			"Width": 1380,
			"Height": 1335,
			"Setting": null,
			"M": "外加剂",
			"R": "山大合盛",
			"i": 7
		}
	]
}
```

### 1.13.2.获取单料仓进出

请求路径：http://http://47.107.119.236:7020/Storage/InOut/?st=st&fld=fld&cName=cName

请求示例：http://http://47.107.119.236:7020/Storage/InOut?st=搅拌站1&fld=外加剂1&cName=1站外加剂1

请求方法：get

请求参数

| 参数名 | 参数值     | 备注 |
| ------ | ---------- | ---- |
| st     | 搅拌站1    |      |
| fld    | 外加剂1    |      |
| cName  | 1站外加剂1 |      |

响应参数

| 参数名 | 说明   |
| ------ | ------ |
| dt     | 日期   |
| in     | 进货量 |
| out    | 出货量 |

响应数据

```json
{
	"count": 33,
	"pageCount": 1,
	"results": [
		{
			"dt": "2022-02-14",
			"in": null,
			"out": null
		},
		{
			"dt": "2022-02-13",
			"in": 29.39,
			"out": null
		},
		{
			"dt": "2022-02-12",
			"in": null,
			"out": null
		},
		{
			"dt": "2022-02-11",
			"in": null,
			"out": null
		},
		{
			"dt": "2022-02-10",
			"in": null,
			"out": null
		},
		...
	]
}
```

 

### 1.13.3.单料仓进货列表

请求路径：http://http://47.107.119.236:7020/Storage/InList/?cName=cName&dt=dt

请求示例：http://http://47.107.119.236:7020/Storage/InList?cName=1站外加剂1&dt=2022-02-13

请求方法：get

请求参数

| 参数名 | 参数值     | 备注 |
| ------ | ---------- | ---- |
| cName  | 1站外加剂1 |      |
| dt     | 2022-02-13 |      |

响应参数

| 参数名   | 说明     |
| -------- | -------- |
| dt       | 回皮时间 |
| in       | 净重     |
| mName    | 品名     |
| mRule    | 规格     |
| supplier | 供货单位 |
| carrier  | 运输单位 |
| car      | 车号     |
| inDt     | 进厂时间 |

响应数据

```json
{
	"count": null,
	"pageCount": 1,
	"results": [
		{
			"dt": "10:19:53",
			"in": 17.63,
			"mName": "外加剂",
			"mRule": "羧酸",
			"supplier": "刘",
			"carrier": "刘",
			"car": "赣C0R626",
			"inDt": "10:19:22"
		}
	]
}
```



### 1.13.4.单料仓出货列表

请求路径：http://http://47.107.119.236:7020/Storage/OutList/?st=st&fld=fld&dt=dt

请求示例：http://http://47.107.119.236:7020/Storage/OutList?st=搅拌站1&fld=外加剂1&dt=2021-10-22

请求方法：get

请求参数

| 参数名 | 参数值     | 备注 |
| ------ | ---------- | ---- |
| st     | 搅拌站1    |      |
| fld    | 外加剂1    |      |
| dt     | 2021-10-22 |      |

响应参数

| 参数名 | 说明     |
| ------ | -------- |
| dt     | 生产时间 |
| out    | 使用量   |
| set    | 配比量   |
| diff   | 误差     |
| mName  | 品名     |
| mRule  | 规格     |

响应数据

```json
{
	"count": 139,
	"pageCount": 1,
	"results": [
		{
			"dt": "15:19:13",
			"out": 28.7,
			"set": 28.7,
			"diff": -0.03,
			"mName": "外加剂",
			"mRule": "砼高效"
		},
		{
			"dt": "15:17:44",
			"out": 28.9,
			"set": 28.7,
			"diff": 0.49,
			"mName": "外加剂",
			"mRule": "砼高效"
		},
		{
			"dt": "15:16:20",
			"out": 28.8,
			"set": 28.7,
			"diff": 0.14,
			"mName": "外加剂",
			"mRule": "砼高效"
		},
		{
			"dt": "15:14:59",
			"out": 28.8,
			"set": 28.7,
			"diff": 0.14,
			"mName": "外加剂",
			"mRule": "砼高效"
		},
        ...
    ]
}
```



## 1.14.订单审批

### 1.14.1.订单审批列表

请求路径：http://47.107.119.236:8088/Order_C

请求方法：get

请求参数

响应参数

响应数据

```json
{
	"count": 1,
	"pageCount": 1,
	"results": [
		{
			"orderId": "1000002",
			"contractId": "G119-00028",
			"prjName": "待定",
			"bulider": "个人",
			"prjAddr": "待定",
			"distance": "20.0",
			"prjPart": "44",
			"hType": "砼",
			"V": "111.0",
			"G": "C40",
			"FG": null,
			"PG": null,
			"slump": "160±20",
			"P": "自卸",
			"tel": "",
			"supDt": "2022-02-16",
			"remark": null,
			"creator": "张三",
			"createDt": "2022-02-16 10:06:57.623",
			"createDev": "微信",
			"reviewer": null,
			"reviewDt": null,
			"reviewDev": null,
			"modifier": null,
			"modifyDt": null,
			"modifyDev": null,
			"extra1": null,
			"extra2": null,
			"extra3": null,
			"extra4": null,
			"extra5": null,
			"extra6": null,
			"extra7": null,
			"extra8": null,
			"extra9": null,
			"extra10": null,
			"pumpReq": "",
			"othReq": "",
			"reviewed": "0"
		},
		{
			"orderId": "1000001",
			"contractId": "G119-00028",
			"prjName": "待定",
			"bulider": "个人",
			"prjAddr": "待定",
			"distance": "20.0",
			"prjPart": "地面",
			"hType": "砼",
			"V": "200.0",
			"G": "C30",
			"FG": null,
			"PG": null,
			"slump": "160±20",
			"P": "自卸",
			"tel": "96541287",
			"supDt": "2022-02-16",
			"remark": null,
			"creator": "张三",
			"createDt": "2022-02-16 09:21:18.470",
			"createDev": "微信",
			"reviewer": null,
			"reviewDt": null,
			"reviewDev": null,
			"modifier": null,
			"modifyDt": null,
			"modifyDev": null,
			"extra1": null,
			"extra2": null,
			"extra3": null,
			"extra4": null,
			"extra5": null,
			"extra6": null,
			"extra7": null,
			"extra8": null,
			"extra9": null,
			"extra10": null,
			"pumpReq": "222",
			"othReq": "哈哈哈",
			"reviewed": "0"
		}
	]
}
```



### 1.14.2.获取单条需审核订单

请求路径：http://47.107.119.236:8088/Order_C/订单号

请求示例：http://47.107.119.236:8088/Order_C/1000002

请求方法：get

请求参数

响应参数

响应数据

```json
{
	"orderId": "1000002",
	"contractId": "G119-00028",
	"prjName": "待定",
	"bulider": "个人",
	"prjAddr": "待定",
	"distance": "20.0",
	"prjPart": "44",
	"hType": "砼",
	"V": "111.0",
	"G": "C40",
	"FG": null,
	"PG": null,
	"slump": "160±20",
	"P": "自卸",
	"tel": "",
	"supDt": "2022-02-16",
	"remark": null,
	"creator": "张三",
	"createDt": "2022-02-16 10:06:57.623",
	"createDev": "微信",
	"reviewer": null,
	"reviewDt": null,
	"reviewDev": null,
	"modifier": null,
	"modifyDt": null,
	"modifyDev": null,
	"extra1": null,
	"extra2": null,
	"extra3": null,
	"extra4": null,
	"extra5": null,
	"extra6": null,
	"extra7": null,
	"extra8": null,
	"extra9": null,
	"extra10": null,
	"pumpReq": "",
	"othReq": "",
	"reviewed": "0"
}
```



### 1.14.3.订单审批

请求路径：http://47.107.119.236:8088/Order_C/订单号

请求示例：http://47.107.119.236:8088/Order_C/1000002

请求方法：put

请求参数(这里body传值，使用的是application/javascript)

```javascript
{"orderId":"1000002","contractId":"G119-00028","prjName":"待定","cust":"个人","bulider":"个人","prjAddr":"待定","distance":"20.0","prjPart":"44","hType":"砼","V":"111.0","G":"C40","slump":"160±20","P":"自卸","tel":"","supDt":"2022-02-16","remark":"","creator":"张三","createDt":"2022-02-16 10:06:57.623","createDev":"微信","pumpReq":"","othReq":"哈哈哈","reviewed":"0","pump":""}
```

响应参数

响应数据

```json
{
	"code": 0,
	"res": "sucess",
	"affected": "0"
}
```



# 微信端

视图

```sql
IF exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[PV_Deliver_E]') and OBJECTPROPERTY(id,N'IsView') = 1)
Drop View [dbo].[PV_Deliver_E]
Go

CREATE VIEW [dbo].[PV_Deliver_E]
AS
SELECT  aa.发货单编号 AS dId, aa.任务编号 AS tId, bb.具体工程名称 AS prjName, bb.具体建设单位 AS cust, 
                   bb.施工部位 AS prjPart, bb.具体施工单位 AS builder, bb.砼强度等级 AS G, bb.抗冻等级 AS FG, bb.抗渗等级 AS PG, 
                   ISNULL(bb.砼强度等级, '') + ISNULL(bb.抗冻等级, '') + ISNULL(bb.抗渗等级, '') AS GG, bb.坍落度 AS slump, 
                   bb.备注 AS tNote, aa.搅拌站 AS std, aa.出车时间 AS dt, aa.调度员 AS dispatcher, aa.质检员 AS inspector, 
                   aa.司磅员 AS sby, aa.内部车号 AS car, aa.司机 AS driver, aa.浇注方式 AS P, aa.泵车号 AS pump, 
                   aa.发车货物类型 AS hType, aa.发车单车数量 AS weightV, aa.注释 AS note, aa.皮重 AS pz, aa.毛重 AS mz, aa.净重 AS jz, 
                   aa.回皮时间 AS tareDt, aa.发车实发数量 AS realV, aa.发车签收量 AS V, aa.是否已过磅 AS weighted, 
                   aa.发车设定量 AS setV, aa.主机操作 AS oper, aa.发车货物类型分类 AS extra1, bb.具体施工地点 AS addr, 
                   bb.具体运距 AS distance, 1 AS cflag, bb.合同编号 AS cId, bb.配合比编号 AS rId, aa.调度安排时间 AS setTime, 
                   aa.返厂时间 AS backTime, DATEDIFF(n, aa.出车时间, aa.返厂时间) AS duration, cc.合同来源 AS custSrc, 
                   cc.承揽业务员 AS Salesman
FROM      dbo.cv_发货单_发货单 AS aa LEFT OUTER JOIN
                   dbo.cv_任务_任务内容 AS bb ON aa.任务编号 = bb.任务编号 LEFT OUTER JOIN
                   dbo.cv_合同_合同内容 AS cc ON bb.合同编号 = cc.合同编号

GO
```

